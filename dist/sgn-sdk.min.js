!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.SGN=e()}(this,function(){"use strict";function t(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var i,n,r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=e(function(t){var e=function(){};e.prototype={bind:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},unbind:function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},e.mixin=function(t){for(var i=["bind","unbind","trigger"],n=0;n<i.length;n++)t.prototype[i[n]]=e.prototype[i[n]]},"exports"in t&&(t.exports=e)}),s=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};n=o,i=i=function(){function t(){this.attrs={}}return t.prototype.keys=["appVersion","appKey","appSecret","authToken","eventTracker","locale","coreSessionToken","coreSessionClientId","coreUrl","graphUrl","eventsTrackUrl","eventsPulseUrl","assetsFileUploadUrl"],t.prototype.set=function(t){var e,i,n;null==t&&(t={}),e={};for(i in t)n=t[i],s.call(this.keys,i)>=0&&(this.attrs[i]=n,e[i]=n);this.trigger("change",e)},t.prototype.get=function(t){return this.attrs[t]},t}(),n.mixin(i);var a,p=i,u=e(function(t,e){!function(t,i){e&&"string"!=typeof e.nodeName?i(e):(t.Mustache={},i(t.Mustache))}(r,function(t){function e(t){return"function"==typeof t}function i(t){return g(t)?"array":typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(t,e){return null!=t&&"object"==typeof t&&e in t}function o(t,e){return f.call(t,e)}function s(t){return!o(v,t)}function a(e,i){function r(t){if("string"==typeof t&&(t=t.split(b,2)),!g(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(n(t[0])+"\\s*"),a=new RegExp("\\s*"+n(t[1])),c=new RegExp("\\s*"+n("}"+t[1]))}if(!e)return[];var o,a,c,l=[],d=[],f=[],v=!1,m=!1;r(i||t.tags);for(var T,k,P,_,x,C,I=new h(e);!I.eos();){if(T=I.pos,P=I.scanUntil(o))for(var L=0,A=P.length;L<A;++L)s(_=P.charAt(L))?f.push(d.length):m=!0,d.push(["text",_,T,T+1]),T+=1,"\n"===_&&function(){if(v&&!m)for(;f.length;)delete d[f.pop()];else f=[];v=!1,m=!1}();if(!I.scan(o))break;if(v=!0,k=I.scan(E)||"name",I.scan(y),"="===k?(P=I.scanUntil(S),I.scan(S),I.scanUntil(a)):"{"===k?(P=I.scanUntil(c),I.scan(w),I.scanUntil(a),k="&"):P=I.scanUntil(a),!I.scan(a))throw new Error("Unclosed tag at "+I.pos);if(x=[k,P,T,I.pos],d.push(x),"#"===k||"^"===k)l.push(x);else if("/"===k){if(!(C=l.pop()))throw new Error('Unopened section "'+P+'" at '+T);if(C[1]!==P)throw new Error('Unclosed section "'+C[1]+'" at '+T)}else"name"===k||"{"===k||"&"===k?m=!0:"="===k&&r(P)}if(C=l.pop())throw new Error('Unclosed section "'+C[1]+'" at '+I.pos);return u(p(d))}function p(t){for(var e,i,n=[],r=0,o=t.length;r<o;++r)(e=t[r])&&("text"===e[0]&&i&&"text"===i[0]?(i[1]+=e[1],i[3]=e[3]):(n.push(e),i=e));return n}function u(t){for(var e,i=[],n=i,r=[],o=0,s=t.length;o<s;++o)switch((e=t[o])[0]){case"#":case"^":n.push(e),r.push(e),n=e[4]=[];break;case"/":r.pop()[5]=e[2],n=r.length>0?r[r.length-1][4]:i;break;default:n.push(e)}return i}function h(t){this.string=t,this.tail=t,this.pos=0}function c(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function l(){this.cache={}}var d=Object.prototype.toString,g=Array.isArray||function(t){return"[object Array]"===d.call(t)},f=RegExp.prototype.test,v=/\S/,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},y=/\s*/,b=/\s+/,S=/\s*=/,w=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var i=e[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},h.prototype.scanUntil=function(t){var e,i=this.tail.search(t);switch(i){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=e.length,e},c.prototype.push=function(t){return new c(t,this)},c.prototype.lookup=function(t){var i,n=this.cache;if(n.hasOwnProperty(t))i=n[t];else{for(var o,s,a=this,p=!1;a;){if(t.indexOf(".")>0)for(i=a.view,o=t.split("."),s=0;null!=i&&s<o.length;)s===o.length-1&&(p=r(i,o[s])),i=i[o[s++]];else i=a.view[t],p=r(a.view,t);if(p)break;a=a.parent}n[t]=i}return e(i)&&(i=i.call(this.view)),i},l.prototype.clearCache=function(){this.cache={}},l.prototype.parse=function(t,e){var i=this.cache,n=i[t];return null==n&&(n=i[t]=a(t,e)),n},l.prototype.render=function(t,e,i){var n=this.parse(t),r=e instanceof c?e:new c(e);return this.renderTokens(n,r,i,t)},l.prototype.renderTokens=function(t,e,i,n){for(var r,o,s,a="",p=0,u=t.length;p<u;++p)s=void 0,"#"===(o=(r=t[p])[0])?s=this.renderSection(r,e,i,n):"^"===o?s=this.renderInverted(r,e,i,n):">"===o?s=this.renderPartial(r,e,i,n):"&"===o?s=this.unescapedValue(r,e):"name"===o?s=this.escapedValue(r,e):"text"===o&&(s=this.rawValue(r)),void 0!==s&&(a+=s);return a},l.prototype.renderSection=function(t,i,n,r){var o=this,s="",a=i.lookup(t[1]);if(a){if(g(a))for(var p=0,u=a.length;p<u;++p)s+=this.renderTokens(t[4],i.push(a[p]),n,r);else if("object"==typeof a||"string"==typeof a||"number"==typeof a)s+=this.renderTokens(t[4],i.push(a),n,r);else if(e(a)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(a=a.call(i.view,r.slice(t[3],t[5]),function(t){return o.render(t,i,n)}))&&(s+=a)}else s+=this.renderTokens(t[4],i,n,r);return s}},l.prototype.renderInverted=function(t,e,i,n){var r=e.lookup(t[1]);if(!r||g(r)&&0===r.length)return this.renderTokens(t[4],e,i,n)},l.prototype.renderPartial=function(t,i,n){if(n){var r=e(n)?n(t[1]):n[t[1]];return null!=r?this.renderTokens(this.parse(r),i,n,r):void 0}},l.prototype.unescapedValue=function(t,e){var i=e.lookup(t[1]);if(null!=i)return i},l.prototype.escapedValue=function(e,i){var n=i.lookup(e[1]);if(null!=n)return t.escape(n)},l.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.3.0",t.tags=["{{","}}"];var T=new l;return t.clearCache=function(){return T.clearCache()},t.parse=function(t,e){return T.parse(t,e)},t.render=function(t,e,n){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+i(t)+'" was given as the first argument for mustache#render(template, view, partials)');return T.render(t,e,n)},t.to_html=function(i,n,r,o){var s=t.render(i,n,r);if(!e(o))return s;o(s)},t.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return m[t]})},t.Scanner=h,t.Context=c,t.Writer=l,t})});a=u;var h,c,l,d;l={t:function(t,e){return a.render(this.translations[t],e)},addTranslations:function(t){var e,i;for(e in t)i=t[e],this.translations[e]=i},translations:{"paged_publication.hotspot_picker.header":"Which offer did you mean?"}},d=h={isBrowser:function(){return"undefined"!=typeof process&&process.browser},isNode:function(){return!h.isBrowser()},error:function(t,e){var i,n;if(t.message=t.message||null,"string"==typeof e)t.message=e;else if("object"==typeof e&&null!=e){for(i in e)n=e[i],t[i]=n;null!=e.message&&(t.message=e.message),null==e.code&&null==e.message||(t.code=e.code||e.name),null!=e.stack&&(t.stack=e.stack)}return t.name=e&&e.name||t.name||t.code||"Error",t.time=new Date,t},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e;return e=16*Math.random()|0,("x"===t?e:3&e|8).toString(16)})},getQueryParam:function(t,e){var i,n,r;return i=e||window.location.href,n=new RegExp("[?&]"+t+"=([^&#]*)","i"),(r=n.exec(i))?r[1]:void 0},formatQueryParams:function(t){return null==t&&(t={}),Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")},getRandomNumberBetween:function(t,e){return Math.floor(Math.random()*e)+t},getOS:function(){var t,e;return t=null,(e=window.navigator.userAgent).indexOf("Windows")>-1?t="Windows":e.indexOf("Mac")>-1?t="macOS":e.indexOf("X11")>-1?t="unix":e.indexOf("Linux")>-1?t="Linux":e.indexOf("iOS")>-1?t="iOS":e.indexOf("Android")>-1&&(t="Android"),t},btoa:function(t){return h.isBrowser()?btoa(t):(null,(t instanceof Buffer?t:new Buffer(t.toString(),"binary")).toString("base64"))},getScreenDimensions:function(){var t,e,i,n;return t=null!=(n=window.devicePixelRatio)?n:1,e={width:window.screen.width,height:window.screen.height},i={width:Math.round(e.width*t),height:Math.round(e.height*t)},{density:t,logical:e,physical:i}},getUtcOffsetSeconds:function(){var t,e,i,n;return i=new Date,t=new Date(i.getFullYear(),0,1,0,0,0,0),n=t.toGMTString(),e=new Date(n.substring(0,n.lastIndexOf(" ")-1)),(t-e)/1e3},getUtcDstOffsetSeconds:function(){return 60*(new Date).getTimezoneOffset()*-1},getColorBrightness:function(t){var e,i,n,r,o;for(t=t.replace("#",""),e=parseInt((e+"").replace(/[^a-f0-9]/gi,""),16),i=[],r=0,o=0;o<3;)n=parseInt(t.substring(2*o,2),16),i[o]=n,n>0&&(r+=n),++o;return r<=381?"dark":"light"},find:function(t,e){var i,n,r;for(n=0,r=t.length;n<r;n++)if(i=t[n],!0===e(i))return i},chunk:function(t,e){var i;for(i=[];t.length;)i.push(t.splice(0,e));return i},throttle:function(t,e,i){var n,r;return null==e&&(e=250),r=void 0,n=void 0,function(){var o,s,a;s=i||this,a=(new Date).getTime(),o=arguments,r&&a<r+e?(clearTimeout(n),n=setTimeout(function(){r=a,t.apply(s,o)},e)):(r=a,t.apply(s,o))}},loadImage:function(t,e){var i;return i=new Image,i.onload=function(){return e(null,i.width,i.height)},i.onerror=function(){return e(new Error)},i.src=t,i},distance:function(t,e,i,n){var r,o,s,a,p;return o=Math.PI*t/180,s=Math.PI*i/180,p=e-n,a=Math.PI*p/180,r=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos(a),r=Math.acos(r),r=180*r/Math.PI,r=60*r*1.1515,r=1.609344*r*1e3},async:{parallel:function(t,e){var i,n,r,o;for(n=t.length,i=[],r=0,o=function(t){return function(){var r,o;for(o=[],r=0,n--;r<arguments.length;)o.push(arguments[r]),r++;i[t]=o,0===n&&e(i)}};r<t.length;)t[r](o(r)),r++}}},(c=new p).set({locale:"en_US",coreUrl:"https://api.etilbudsavis.dk",graphUrl:"https://graph.service.shopgun.com",eventsTrackUrl:"https://events.service.shopgun.com/track",eventsPulseUrl:"wss://events.service.shopgun.com/pulse",assetsFileUploadUrl:"https://assets.service.shopgun.com/upload"});var g,f={config:c,i18n:l,util:d},v=f,m={key:"sgn-",storage:function(){var t;try{return t=window.localStorage,t[this.key+"test-storage"]="foobar",delete t[this.key+"test-storage"],t}catch(t){return{}}}(),get:function(t){try{return JSON.parse(this.storage[""+this.key+t])}catch(t){}},set:function(t,e){try{this.storage[""+this.key+t]=JSON.stringify(e)}catch(t){}return this}};g=v;var y,b={key:"sgn-",get:function(t){var e,i,n,r,o,s;if(!g.util.isNode()){try{for(o=""+this.key+t+"=",n=0,r=(e=document.cookie.split(";")).length;n<r;n++)0===(i=e[n].trim()).indexOf(o)&&(s=i.substring(o.length,i.length));s=JSON.parse(s)}catch(t){s={}}return s}},set:function(t,e){var i,n,r;if(!g.util.isNode())try{n=365,i=new Date,r=JSON.stringify(e),i.setTime(i.getTime()+24*n*60*60*1e3),document.cookie=""+this.key+t+"="+r+";expires="+i.toUTCString()+";path=/"}catch(t){}}};y=v;var S,w={};S=v;var E,T,k,P,_,x={fileUpload:function(t,e,i){var n,r;if(null==t&&(t={}),null==t.file)throw new Error("File is not defined");r=S.config.get("assetsFileUploadUrl"),n={file:t.file},S.request({method:"post",url:r,formData:n,timeout:36e5,headers:{Accept:"application/json"}},function(t,i){null!=t?e(S.util.error(new Error("Request error"),{code:"RequestError"})):200===i.statusCode?e(null,JSON.parse(i.body)):e(S.util.error(new Error("Request error"),{code:"RequestError",statusCode:i.statusCode}))},function(t,e){"function"==typeof i&&i({progress:t/e,loaded:t,total:e})})}};E=v,k=m,_=(P=function(){var t;return t=k.get("event-tracker-pool"),!1===Array.isArray(t)&&(t=[]),t})(),k.set("event-tracker-pool",[]);try{window.addEventListener("unload",function(){_=_.concat(P()),k.set("event-tracker-pool",_)},!1)}catch(t){}var C,I,L=T=function(){function t(t){var e,i,n;null==t&&(t={}),i=this.defaultOptions;for(e in i)n=i[e],this[e]=t[e]||n;this.dispatching=!1,this.session={id:E.util.uuid()},this.client={trackId:this.trackId,id:E.client.id},this.view={path:[],previousPath:[],uri:null},this.location={},this.application={},this.identity={},this.interval=setInterval(this.dispatch.bind(this),this.dispatchInterval)}return t.prototype.defaultOptions={trackId:null,dispatchInterval:3e3,dispatchLimit:100,poolLimit:1e3,dryRun:!1},t.prototype.trackEvent=function(t,e,i){if(null==e&&(e={}),null==i&&(i="1.0.0"),"string"!=typeof t)throw E.util.error(new Error("Event type is required"));if(null!=this.trackId){for(_.push({id:E.util.uuid(),type:t,version:i,recordedAt:(new Date).toISOString(),sentAt:null,client:{id:this.client.id,trackId:this.client.trackId},context:this.getContext(),properties:e});this.getPoolSize()>this.poolLimit;)_.shift();return this}},t.prototype.identify=function(t){return this.identity.id=t,this},t.prototype.setLocation=function(t){var e,i;return null==t&&(t={}),this.location.determinedAt=new Date(t.timestamp).toISOString(),this.location.latitude=t.latitude,this.location.longitude=t.longitude,this.location.altitude=t.altitude,this.location.accuracy={horizontal:null!=(e=t.accuracy)?e.horizontal:void 0,vertical:null!=(i=t.accuracy)?i.vertical:void 0},this.location.speed=t.speed,this.location.floor=t.floor,this},t.prototype.setApplication=function(t){return null==t&&(t={}),this.application.name=t.name,this.application.version=t.version,this.application.build=t.build,this},t.prototype.setView=function(t){return this.view.previousPath=this.view.path,!0===Array.isArray(t)&&(this.view.path=t),this.view.uri=window.location.href,this},t.prototype.getView=function(){var t;return t={},this.view.path.length>0&&(t.path=this.view.path),this.view.previousPath.length>0&&(t.previousPath=this.view.previousPath),null!=this.view.uri&&(t.uri=this.view.uri),t},t.prototype.getContext=function(){var t,e,i,n,r,o,s,a;return a=E.util.getScreenDimensions(),r=E.util.getOS(),i={userAgent:window.navigator.userAgent,locale:navigator.language,timeZone:{utcOffsetSeconds:E.util.getUtcOffsetSeconds(),utcDstOffsetSeconds:E.util.getUtcDstOffsetSeconds()},device:{screen:{width:a.physical.width,height:a.physical.height,density:a.density}},session:{id:this.session.id},view:this.getView()},t={name:this.application.name,version:this.application.version,build:this.application.build},e={source:E.util.getQueryParam("utm_source"),medium:E.util.getQueryParam("utm_medium"),name:E.util.getQueryParam("utm_campaign"),term:E.util.getQueryParam("utm_term"),content:E.util.getQueryParam("utm_content")},n={determinedAt:this.location.determinedAt,latitude:this.location.latitude,longitude:this.location.longitude,altitude:this.location.altitude,speed:this.location.speed,floor:this.location.floor,accuracy:{horizontal:null!=(o=this.location.accuracy)?o.horizontal:void 0,vertical:null!=(s=this.location.accuracy)?s.vertical:void 0}},null!=r&&(i.os={name:r}),document.referrer.length>0&&(i.session.referrer=document.referrer),["name","version","build"].forEach(function(e){"string"==typeof t[e]&&0!==t[e].length||delete t[e]}),Object.keys(t).length>0&&(i.application=t),["source","medium","name","term","content"].forEach(function(t){"string"==typeof e[t]&&0!==e[t].length||delete e[t]}),Object.keys(e).length>0&&(i.campaign=e),["latitude","longitude","altitude","speed","floor"].forEach(function(t){"number"!=typeof n[t]&&delete n[t]}),"number"!=typeof n.accuracy.horizontal&&delete n.accuracy.horizontal,"number"!=typeof n.accuracy.vertical&&delete n.accuracy.vertical,0===Object.keys(n.accuracy).length&&delete n.accuracy,"string"==typeof n.determinedAt&&0!==n.determinedAt.length||delete n.determinedAt,Object.keys(n).length>0&&(i.location=n),null!=this.identity.id&&(i.personId=this.identity.id),i},t.prototype.getPoolSize=function(){return _.length},t.prototype.dispatch=function(){var t,e;if(!0!==this.dispatching&&0!==this.getPoolSize())return!0===this.dryRun?_.splice(0,this.dispatchLimit):(t=_.slice(0,this.dispatchLimit),e=0,this.dispatching=!0,this.ship(t,function(t){return function(i,n){t.dispatching=!1,null==i&&(n.events.forEach(function(t){"validation_error"===t.status||"ack"===t.status?_=_.filter(function(e){return e.id!==t.id}):e++}),t.getPoolSize()>=t.dispatchLimit&&0===e&&t.dispatch())}}(this)),this)},t.prototype.ship=function(t,e){var i,n,r;return null==t&&(t=[]),i=new XMLHttpRequest,r=E.config.get("eventsTrackUrl"),n={events:t.map(function(t){return t.sentAt=(new Date).toISOString(),t})},i.open("POST",r),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Accept","application/json"),i.timeout=2e4,i.onload=function(){if(200===i.status)try{e(null,JSON.parse(i.responseText))}catch(t){e(E.util.error(new Error("Could not parse JSON")))}else e(E.util.error(new Error("Server did not accept request")))},i.onerror=function(){e(E.util.error(new Error("Could not perform network request")))},i.send(JSON.stringify(n)),this},t}();C=o,I=function(){function t(){this.destroyed=!1,this.connection=this.connect()}return t.prototype.destroy=function(){return this.destroyed=!0,this.connection.close(),this},t.prototype.connect=function(){var t;return t=new WebSocket(SGN.config.get("eventsPulseUrl")),t.onopen=this.onOpen.bind(this),t.onmessage=this.onMessage.bind(this),t.onerror=this.onError.bind(this),t.onclose=this.onClose.bind(this),t},t.prototype.onOpen=function(){this.trigger("open")},t.prototype.onMessage=function(t){try{this.trigger("event",JSON.parse(t.data))}catch(t){}},t.prototype.onError=function(){},t.prototype.onClose=function(){!1===this.destroyed&&setTimeout(function(t){return function(){t.connection=t.connect()}}(this),2e3)},t}(),C.mixin(I);var A,O,N={Tracker:L,Pulse:I};A=v,O=function(t){var e;return null==t&&(t=[]),e={},t.map(function(t){var i,n,r;i=(n=t.split("; ")[0].split("="))[0],r=n[1],e[i]=r}),e};var z,M={request:function(t,e){var i,n,r;null==t&&(t={}),r=A.config.get("graphUrl"),i=A.config.get("appKey"),n=A.config.get("authToken"),t={method:"post",url:r,timeout:12e3,json:!0,headers:{},body:{query:t.query,operationName:t.operationName,variables:t.variables}},null!=i&&(t.headers.Authorization="Basic "+A.util.btoa("app-key:"+i)),A.util.isNode()&&null!=n?t.cookies=[{key:"shopgun-auth-token",value:n,url:r}]:A.util.isBrowser()&&(t.useCookies=!0),A.request(t,function(t,i){var n,r;null!=t?e(A.util.error(new Error("Graph request error"),{code:"GraphRequestError"})):(A.util.isNode()&&(n=O(null!=(r=i.headers)?r["set-cookie"]:void 0)["shopgun-auth-token"],A.config.get("authToken")!==n&&A.config.set("authToken",n)),200===i.statusCode?e(null,i.body):e(A.util.error(new Error("Graph API error"),{code:"GraphAPIError",statusCode:i.statusCode})))})}};z=v;var D,R,q,U,H,F=e(function(t){!function(e){function i(t){return t.map(function(t){return n(t.toString(16),2)}).join("")}function n(t,e){return t.length>e?t:Array(e-t.length+1).join("0")+t}var r={bytesToHex:function(t){return i(t)},hexToBytes:function(t){if(t.length%2==1)throw new Error("hexToBytes can't have a string with an odd number of characters.");return 0===t.indexOf("0x")&&(t=t.slice(2)),t.match(/../g).map(function(t){return parseInt(t,16)})}};t.exports?t.exports=r:e.convertHex=r}(r)}),V=e(function(t){!function(e){var i={bytesToString:function(t){return t.map(function(t){return String.fromCharCode(t)}).join("")},stringToBytes:function(t){return t.split("").map(function(t){return t.charCodeAt(0)})}};i.UTF8={bytesToString:function(t){return decodeURIComponent(escape(i.bytesToString(t)))},stringToBytes:function(t){return i.stringToBytes(unescape(encodeURIComponent(t)))}},t.exports?t.exports=i:e.convertString=i}(r)}),X=e(function(t){!function(e){function i(t,e){t.constructor===String&&(t=n.convertString.UTF8.stringToBytes(t));var i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],r=o(t),a=8*t.length;r[a>>5]|=128<<24-a%32,r[15+(a+64>>9<<4)]=a;for(var u=0;u<r.length;u+=16)p(i,r,u);var h=s(i);return e&&e.asBytes?h:e&&e.asString?n.convertString.bytesToString(h):n.bytesToHex(h)}var n={};t.exports?(n.bytesToHex=F.bytesToHex,n.convertString=V,t.exports=i):(n.bytesToHex=e.convertHex.bytesToHex,n.convertString=e.convertString,e.sha256=i);var r=[];!function(){for(var t=2,e=0;e<64;)(function(t){for(var e=Math.sqrt(t),i=2;i<=e;i++)if(!(t%i))return!1;return!0})(t)&&(r[e]=function(t){return 4294967296*(t-(0|t))|0}(Math.pow(t,1/3)),e++),t++}();var o=function(t){for(var e=[],i=0,n=0;i<t.length;i++,n+=8)e[n>>>5]|=t[i]<<24-n%32;return e},s=function(t){for(var e=[],i=0;i<32*t.length;i+=8)e.push(t[i>>>5]>>>24-i%32&255);return e},a=[],p=function(t,e,i){for(var n=t[0],o=t[1],s=t[2],p=t[3],u=t[4],h=t[5],c=t[6],l=t[7],d=0;d<64;d++){if(d<16)a[d]=0|e[i+d];else{var g=a[d-15],f=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,v=a[d-2],m=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;a[d]=f+a[d-7]+m+a[d-16]}var y=n&o^n&s^o&s,b=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),S=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&h^~u&c)+r[d]+a[d];l=c,c=h,h=u,u=p+S|0,p=s,s=o,o=n,n=S+(b+y)|0}t[0]=t[0]+n|0,t[1]=t[1]+o|0,t[2]=t[2]+s|0,t[3]=t[3]+p|0,t[4]=t[4]+u|0,t[5]=t[5]+h|0,t[6]=t[6]+c|0,t[7]=t[7]+l|0};i.x2=function(t,e){return i(i(t,{asBytes:!0}),e)}}(r)});D=v,H=X,q=b,R=[];var j,W,B,Y,Z,K={request:j=function(t,e){null==t&&(t={}),null==e&&(e=function(){}),z.CoreKit.session.ensure(function(i){var n,r,o,s,a,p,u,h,c,l,d,g;return null!=i?e(i):(g=null!=(h=t.url)?h:"",a=null!=(c=t.headers)?c:{},d=z.config.get("coreSessionToken"),o=z.config.get("coreSessionClientId"),r=z.config.get("appVersion"),n=z.config.get("appSecret"),p=z.config.get("locale"),u=null!=(l=t.qs)?l:{},s=t.geolocation,a["X-Token"]=d,null!=n&&(a["X-Signature"]=z.CoreKit.session.sign(n,d)),null!=p&&(u.r_locale=p),null!=r&&(u.api_av=r),null!=o&&(u.client_id=o),null!=s&&(null!=s.latitude&&null==u.r_lat&&(u.r_lat=s.latitude),null!=s.longitude&&null==u.r_lng&&(u.r_lng=s.longitude),null!=s.radius&&null==u.r_radius&&(u.r_radius=s.radius),null!=s.sensor&&null==u.r_sensor&&(u.r_sensor=s.sensor)),z.request({method:t.method,url:z.config.get("coreUrl")+g,qs:u,body:t.body,formData:t.formData,headers:a,json:!0,useCookies:!1},function(t,i){var n;null!=t?e(z.util.error(new Error("Core request error"),{code:"CoreRequestError"})):(d=z.config.get("coreSessionToken"),n=i.headers["x-token"],d!==n&&z.CoreKit.session.saveToken(n),i.statusCode>=200&&i.statusCode<300||304===i.statusCode?e(null,i.body):e(z.util.error(new Error("Core API error"),{code:"CoreAPIError",statusCode:i.statusCode})))}))})},session:W=U={ttl:5184e3,saveToken:function(t){D.config.set({coreSessionToken:t}),U.saveCookie()},saveClientId:function(t){D.config.set({coreSessionClientId:t}),U.saveCookie()},saveCookie:function(){q.set("session",{token:D.config.get("coreSessionToken"),client_id:D.config.get("coreSessionClientId")})},create:function(t){D.request({method:"post",url:D.config.get("coreUrl")+"/v2/sessions",json:!0,qs:{api_key:D.config.get("appKey"),token_ttl:U.ttl}},function(e,i){null!=e?t(e):201===i.statusCode?(U.saveToken(i.body.token),U.saveClientId(i.body.client_id),t(e,i.body)):t(new Error("Could not create session"))})},update:function(t){var e,i,n;i={},n=D.config.get("coreSessionToken"),e=D.config.get("appSecret"),i["X-Token"]=n,null!=e&&(i["X-Signature"]=U.sign(e,n)),D.request({url:D.config.get("coreUrl")+"/v2/sessions",headers:i,json:!0},function(e,i){null!=e?t(e):200===i.statusCode?(U.saveToken(i.body.token),U.saveClientId(i.body.client_id),t(e,i.body)):t(new Error("Could not update session"))})},renew:function(t){var e,i,n;i={},n=D.config.get("coreSessionToken"),e=D.config.get("appSecret"),i["X-Token"]=n,null!=e&&(i["X-Signature"]=U.sign(e,n)),D.request({method:"put",url:D.config.get("coreUrl")+"/v2/sessions",headers:i,json:!0},function(e,i){null!=e?t(e):200===i.statusCode?(U.saveToken(i.body.token),U.saveClientId(i.body.client_id),t(e,i.body)):t(new Error("Could not renew session"))})},ensure:function(t){var e,i;i=R.length,e=function(t){R=R.filter(function(e){return e(t),!1})},R.push(t),0===i&&(null==D.config.get("coreSessionToken")?U.create(e):e())},sign:function(t,e){return H([t,e].join(""))}}};B=o,Z=v,Y=function(){function t(t){this.options=null!=t?t:{},this.contentsRendered=!1,this.hotspotsRendered=!1,this.el=this.renderEl()}return t.prototype.getId=function(){return this.options.id},t.prototype.getEl=function(){return this.el},t.prototype.getPages=function(){return this.options.pages},t.prototype.renderEl=function(){var t,e;return t=document.createElement("div"),e=this.getPages().map(function(t){return t.id}),t.className="verso__page-spread sgn-pp__page-spread",t.setAttribute("data-id",this.getId()),t.setAttribute("data-type","page"),t.setAttribute("data-width",this.options.width),t.setAttribute("data-page-ids",e.join(",")),t.setAttribute("data-max-zoom-scale",this.options.maxZoomScale),t.setAttribute("data-zoomable",!1),t},t.prototype.renderContents=function(){var t,e,i,n,r;return e=this.getId(),t=this.getEl(),r=this.getPages(),n=r.length,i=0,r.forEach(function(o){return function(s,a){var p,u,h;p=s.images.medium,h=document.createElement("div"),u=document.createElement("div"),h.className="sgn-pp__page verso__page",null!=s.id&&(h.dataset.id=s.id),2===n&&(h.className+=0===a?" verso-page--verso":" verso-page--recto"),h.appendChild(u),t.appendChild(h),u.className="sgn-pp-page__loader",u.innerHTML="<span>"+s.label+"</span>",Z.util.loadImage(p,function(a,c,l){var d;null==a?(d=++i===n,h.style.backgroundImage="url("+p+")",h.dataset.width=c,h.dataset.height=l,h.innerHTML="&nbsp;",d&&(t.dataset.zoomable=!0),o.trigger("pageLoaded",{pageSpreadId:e,page:s}),d&&o.trigger("pagesLoaded",{pageSpreadId:e,pages:r})):u.innerHTML="<span>!</span>"})}}(this)),this.contentsRendered=!0,this},t.prototype.clearContents=function(t,e){return this.el.innerHTML="",this.contentsRendered=!1,this},t.prototype.zoomIn=function(){var t,e;t=[].slice.call(this.el.querySelectorAll(".sgn-pp__page")),e=this.getPages(),t.forEach(function(t){return function(i){var n,r,o;n=i.dataset.id,o=Z.util.find(e,function(t){return t.id===n}),r=o.images.large,Z.util.loadImage(r,function(e){null==e&&"true"===t.el.dataset.active&&(i.dataset.image=i.style.backgroundImage,i.style.backgroundImage="url("+r+")")})}}(this))},t.prototype.zoomOut=function(){[].slice.call(this.el.querySelectorAll(".sgn-pp__page[data-image]")).forEach(function(t){t.style.backgroundImage=t.dataset.image,delete t.dataset.image})},t}(),B.mixin(Y);var G,J,Q,$;G=o,J=Y,$=v,Q=function(){function t(t){this.options=t,this.collection=[],this.ids={}}return t.prototype.get=function(t){return this.ids[t]},t.prototype.getFrag=function(){var t;return t=document.createDocumentFragment(),this.collection.forEach(function(e){return t.appendChild(e.el)}),t},t.prototype.update=function(t){var e,i,n,r,o,s,a,p;return null==t&&(t="single"),s=[],i={},a=this.options.pages.slice(),p=this.options.width,r=this.options.maxZoomScale,"single"===t?a.forEach(function(t){return s.push([t])}):(e=a.shift(),n=a.length%2==1?a.pop():null,o=$.util.chunk(a,2),null!=e&&s.push([e]),o.forEach(function(t){return s.push(t.map(function(t){return t}))}),null!=n&&s.push([n])),this.collection=s.map(function(e){return function(n,o){var s,a;return s=t+"-"+o,(a=new J({width:p,maxZoomScale:r,pages:n,id:s})).bind("pageLoaded",function(t){return e.trigger("pageLoaded",t)}),a.bind("pagesLoaded",function(t){return e.trigger("pagesLoaded",t)}),i[s]=a,a}}(this)),this.ids=i,this},t}(),G.mixin(Q);var tt,et,it,nt,rt=Q,ot=e(function(e,i){!function(t){e.exports=t()}(function(){return function e(i,n,r){function o(a,p){if(!n[a]){if(!i[a]){var u="function"==typeof t&&t;if(!p&&u)return u(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[a]={exports:{}};i[a][0].call(c.exports,function(t){var e=i[a][1][t];return o(e||t)},c,c.exports,e,i,n,r)}return n[a].exports}for(var s="function"==typeof t&&t,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,i){e.exports=function(){function t(t){this.el=t,this.run=0}return t.prototype.animate=function(t,e){var i,n,r,o,s,a,p,u,h,c,l,d,g;return null==t&&(t={}),null==e&&(e=function(){}),d=null!=(r=t.x)?r:0,g=null!=(o=t.y)?o:0,h=null!=(s=t.scale)?s:1,n=null!=(a=t.easing)?a:"ease-out",i=null!=(p=t.duration)?p:0,u=++this.run,c="translate3d("+d+", "+g+", 0px) scale3d("+h+", "+h+", 1)",this.el.style.transform===c?e():i>0?(l=function(t){return function(){u===t.run&&(t.el.removeEventListener("transitionend",l),t.el.style.transition="none",e())}}(this),this.el.addEventListener("transitionend",l,!1),this.el.style.transition="transform "+n+" "+i+"ms",this.el.style.transform=c):(this.el.style.transition="none",this.el.style.transform=c,e()),this},t}()},{}],2:[function(t,e,i){e.exports=function(){function t(t,e){this.el=t,this.options=null!=e?e:{},this.visibility="gone",this.positioned=!1,this.active=!1,this.id=this.options.id,this.type=this.options.type,this.pageIds=this.options.pageIds,this.width=this.options.width,this.left=this.options.left,this.maxZoomScale=this.options.maxZoomScale}return t.prototype.isZoomable=function(){return this.getMaxZoomScale()>1&&"false"!==this.getEl().getAttribute("data-zoomable")},t.prototype.isScrollable=function(){return this.getEl().classList.contains("verso--scrollable")},t.prototype.getEl=function(){return this.el},t.prototype.getOverlayEls=function(){return this.getEl().querySelectorAll(".verso__overlay")},t.prototype.getPageEls=function(){return this.getEl().querySelectorAll(".verso__page")},t.prototype.getRect=function(){return this.getEl().getBoundingClientRect()},t.prototype.getContentRect=function(){var t,e,i,n,r,o,s,a,p,u,h,c,l,d,g;for(u={top:null,left:null,right:null,bottom:null,width:null,height:null},e=0,i=(h=this.getPageEls()).length;e<i;e++)t=(a=h[e]).getBoundingClientRect(),o=a.offsetTop,n=a.offsetLeft,s=o-t.top,r=n-t.left,((p={top:t.top+s,left:t.left+r,right:t.right+r,bottom:t.bottom+s,width:t.width,height:t.height}).top<u.top||null==u.top)&&(u.top=p.top),(p.left<u.left||null==u.left)&&(u.left=p.left),(p.right>u.right||null==u.right)&&(u.right=p.right),(p.bottom>u.bottom||null==u.bottom)&&(u.bottom=p.bottom);return u.top=null!=(c=u.top)?c:0,u.left=null!=(l=u.left)?l:0,u.right=null!=(d=u.right)?d:0,u.bottom=null!=(g=u.bottom)?g:0,u.width=u.right-u.left,u.height=u.bottom-u.top,u},t.prototype.getId=function(){return this.id},t.prototype.getType=function(){return this.type},t.prototype.getPageIds=function(){return this.pageIds},t.prototype.getWidth=function(){return this.width},t.prototype.getLeft=function(){return this.left},t.prototype.getMaxZoomScale=function(){return this.maxZoomScale},t.prototype.getVisibility=function(){return this.visibility},t.prototype.setVisibility=function(t){return this.visibility!==t&&(this.getEl().style.display="visible"===t?"block":"none",this.visibility=t),this},t.prototype.position=function(){return!1===this.positioned&&(this.getEl().style.left=this.getLeft()+"%",this.positioned=!0),this},t.prototype.activate=function(){this.active=!0,this.getEl().setAttribute("data-active",this.active)},t.prototype.deactivate=function(){this.active=!1,this.getEl().setAttribute("data-active",this.active)},t}()},{}],3:[function(t,e,i){var n,r,o,s,a;r=t("hammerjs"),o=t("microevent"),s=t("./page_spread"),n=t("./animation"),a=function(){function t(t,e){var i,o,s,a,p;this.el=t,this.options=null!=e?e:{},this.swipeVelocity=null!=(i=this.options.swipeVelocity)?i:.3,this.swipeThreshold=null!=(o=this.options.swipeThreshold)?o:10,this.navigationDuration=null!=(s=this.options.navigationDuration)?s:240,this.navigationPanDuration=null!=(a=this.options.navigationPanDuration)?a:200,this.zoomDuration=null!=(p=this.options.zoomDuration)?p:200,this.position=-1,this.pinching=!1,this.panning=!1,this.transform={left:0,top:0,scale:1},this.startTransform={left:0,top:0,scale:1},this.tap={count:0,delay:250,timeout:null},this.scrollerEl=this.el.querySelector(".verso__scroller"),this.pageSpreadEls=this.el.querySelectorAll(".verso__page-spread"),this.pageSpreads=this.traversePageSpreads(this.pageSpreadEls),this.pageIds=this.buildPageIds(this.pageSpreads),this.animation=new n(this.scrollerEl),this.hammer=new r.Manager(this.scrollerEl,{touchAction:"none",enable:!1,inputClass:"ontouchstart"in window?r.TouchInput:null}),this.hammer.add(new r.Pan({threshold:5,direction:r.DIRECTION_ALL})),this.hammer.add(new r.Tap({event:"singletap",interval:0})),this.hammer.add(new r.Pinch),this.hammer.add(new r.Press({time:500})),this.hammer.on("panstart",this.panStart.bind(this)),this.hammer.on("panmove",this.panMove.bind(this)),this.hammer.on("panend",this.panEnd.bind(this)),this.hammer.on("pancancel",this.panEnd.bind(this)),this.hammer.on("singletap",this.singletap.bind(this)),this.hammer.on("pinchstart",this.pinchStart.bind(this)),this.hammer.on("pinchmove",this.pinchMove.bind(this)),this.hammer.on("pinchend",this.pinchEnd.bind(this)),this.hammer.on("pinchcancel",this.pinchEnd.bind(this)),this.hammer.on("press",this.press.bind(this))}return t.prototype.start=function(){var t,e;return t=null!=(e=this.getPageSpreadPositionFromPageId(this.options.pageId))?e:0,this.hammer.set({enable:!0}),this.navigateTo(t,{duration:0}),this.resizeListener=this.resize.bind(this),this.touchStartListener=this.touchStart.bind(this),this.touchEndListener=this.touchEnd.bind(this),this.el.addEventListener("touchstart",this.touchStartListener,!1),this.el.addEventListener("touchend",this.touchEndListener,!1),window.addEventListener("resize",this.resizeListener,!1),this},t.prototype.destroy=function(){return this.hammer.destroy(),this.el.removeEventListener("touchstart",this.touchStartListener),this.el.removeEventListener("touchend",this.touchEndListener),window.removeEventListener("resize",this.resizeListener),this},t.prototype.first=function(t){return this.navigateTo(0,t)},t.prototype.prev=function(t){return this.navigateTo(this.getPosition()-1,t)},t.prototype.next=function(t){return this.navigateTo(this.getPosition()+1,t)},t.prototype.last=function(t){return this.navigateTo(this.getPageSpreadCount()-1,t)},t.prototype.navigateTo=function(t,e){var i,n,r,o,s,a,p,u,h;null==e&&(e={}),t<0||t>this.getPageSpreadCount()-1||(o=this.getPosition(),r=this.getPageSpreadFromPosition(o),i=this.getPageSpreadFromPosition(t),n=this.getCarouselFromPageSpread(i),h=null!=(a=e.velocity)?a:1,s=null!=(p=e.duration)?p:this.navigationDuration,s/=Math.abs(h),u=i.isScrollable()?"pan-y":"none",null!=r&&r.deactivate(),i.activate(),n.visible.forEach(function(t){return t.position().setVisibility("visible")}),this.hammer.set({touchAction:u}),this.transform.left=this.getLeftTransformFromPageSpread(t,i),this.setPosition(t),this.transform.scale>1&&(this.transform.top=0,this.transform.scale=1,this.trigger("zoomedOut",{position:o})),this.trigger("beforeNavigation",{currentPosition:o,newPosition:t}),this.animation.animate({x:this.transform.left+"%",duration:s},function(t){return function(){(n=t.getCarouselFromPageSpread(t.getActivePageSpread())).gone.forEach(function(t){return t.setVisibility("gone")}),t.trigger("afterNavigation",{newPosition:t.getPosition(),previousPosition:o})}}(this)))},t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t){return this.position=t,this},t.prototype.getLeftTransformFromPageSpread=function(t,e){var i;return i=0,t===this.getPageSpreadCount()-1?i=100-e.getWidth()-e.getLeft():t>0&&(i=(100-e.getWidth())/2-e.getLeft()),i},t.prototype.getCarouselFromPageSpread=function(t){var e;return e={visible:[],gone:[]},this.pageSpreads.forEach(function(i){var n;n=!1,i.getLeft()<=t.getLeft()?i.getLeft()+i.getWidth()>t.getLeft()-100&&(n=!0):i.getLeft()-i.getWidth()<t.getLeft()+100&&(n=!0),!0===n?e.visible.push(i):e.gone.push(i)}),e},t.prototype.traversePageSpreads=function(t){var e,i,n,r,o,a,p,u,h,c,l;for(h=[],r=0,n=0,o=t.length;n<o;n++)i=(e=t[n]).getAttribute("data-id"),c=e.getAttribute("data-type"),p=null!=(p=e.getAttribute("data-page-ids"))?p.split(",").map(function(t){return t}):[],a=null!=(a=e.getAttribute("data-max-zoom-scale"))?+a:1,l=e.getAttribute("data-width"),u=new s(e,{id:i,type:c,pageIds:p,maxZoomScale:a,width:l=null!=l?+l:100,left:r}),r+=l,h.push(u);return h},t.prototype.buildPageIds=function(t){var e;return e={},t.forEach(function(t,i){t.options.pageIds.forEach(function(i){e[i]=t})}),e},t.prototype.isCoordinateInsideElement=function(t,e,i){var n;return n=i.getBoundingClientRect(),t>=n.left&&t<=n.right&&e>=n.top&&e<=n.bottom},t.prototype.getCoordinateInfo=function(t,e,i){var n,r,o,s,a,p,u,h,c,l;for(r={x:t-=this.el.offsetLeft,y:e-=this.el.offsetTop,contentX:0,contentY:0,pageX:0,pageY:0,overlayEls:[],pageEl:null,isInsideContentX:!1,isInsideContentY:!1,isInsideContent:!1},n=i.getContentRect(),h=i.getOverlayEls(),l=i.getPageEls(),o=0,a=h.length;o<a;o++)u=h[o],this.isCoordinateInsideElement(t,e,u)&&r.overlayEls.push(u);for(s=0,p=l.length;s<p;s++)if(c=l[s],this.isCoordinateInsideElement(t,e,c)){r.pageEl=c;break}return r.contentX=(t-n.left)/Math.max(1,n.width),r.contentY=(e-n.top)/Math.max(1,n.height),null!=r.pageEl&&(r.isInsideContentX=r.contentX>=0&&r.contentX<=1,r.isInsideContentY=r.contentY>=0&&r.contentY<=1,r.isInsideContent=r.isInsideContentX&&r.isInsideContentY),r},t.prototype.getPageSpreadCount=function(){return this.pageSpreads.length},t.prototype.getActivePageSpread=function(){return this.getPageSpreadFromPosition(this.getPosition())},t.prototype.getPageSpreadFromPosition=function(t){return this.pageSpreads[t]},t.prototype.getPageSpreadPositionFromPageId=function(t){var e,i,n,r;for(e=i=0,n=(r=this.pageSpreads).length;i<n;e=++i)if(r[e].options.pageIds.indexOf(t)>-1)return e},t.prototype.getPageSpreadBounds=function(t){var e,i;return i=t.getRect(),e=t.getContentRect(),{left:(e.left-i.left)/i.width*100,top:(e.top-i.top)/i.height*100,width:e.width/i.width*100,height:e.height/i.height*100,pageSpreadRect:i,pageSpreadContentRect:e}},t.prototype.clipCoordinate=function(t,e,i,n){return i*e<100?t=n*-e+50-i*e/2:(t=Math.min(t,n*-e),t=Math.max(t,n*-e-i*e+100)),t},t.prototype.zoomTo=function(t,e){var i,n,r,o,s,a,p,u,h;null==t&&(t={}),p=t.scale,i=this.getActivePageSpread(),o=this.getPageSpreadBounds(i),r=(n=i.getLeft())*this.transform.scale,u=null!=(s=t.x)?s:0,h=null!=(a=t.y)?a:0,1!==p?(u-=o.pageSpreadRect.left,h-=o.pageSpreadRect.top,u=u/(o.pageSpreadRect.width/this.transform.scale)*100,h=h/(o.pageSpreadRect.height/this.transform.scale)*100,u=this.transform.left+r+u-u*p/this.transform.scale,h=this.transform.top+h-h*p/this.transform.scale,!1!==t.bounds&&p>1&&(u=this.clipCoordinate(u,p,o.width,o.left),h=this.clipCoordinate(h,p,o.height,o.top))):(u=0,h=0),u-=n*p,this.transform.left=u,this.transform.top=h,this.transform.scale=p,this.animation.animate({x:u+"%",y:h+"%",scale:p,easing:t.easing,duration:t.duration},e)},t.prototype.refresh=function(){return this.pageSpreadEls=this.el.querySelectorAll(".verso__page-spread"),this.pageSpreads=this.traversePageSpreads(this.pageSpreadEls),this.pageIds=this.buildPageIds(this.pageSpreads),this},t.prototype.panStart=function(t){var e,i,n;(this.transform.scale>1||t.direction===r.DIRECTION_LEFT||t.direction===r.DIRECTION_RIGHT)&&(n=t.center.x,e=30,i=this.scrollerEl.offsetWidth,n>e&&n<i-e&&(this.startTransform.left=this.transform.left,this.startTransform.top=this.transform.top,this.panning=!0,this.trigger("panStart")))},t.prototype.panMove=function(t){var e,i,n,r,o,s;!0!==this.pinching&&!1!==this.panning&&(this.transform.scale>1?(i=(e=this.getActivePageSpread()).getLeft()*this.transform.scale,n=this.getPageSpreadBounds(e),r=this.transform.scale,o=this.startTransform.left+i+t.deltaX/this.scrollerEl.offsetWidth*100,s=this.startTransform.top+t.deltaY/this.scrollerEl.offsetHeight*100,o=this.clipCoordinate(o,r,n.width,n.left),s=this.clipCoordinate(s,r,n.height,n.top),o-=i,this.transform.left=o,this.transform.top=s,this.animation.animate({x:o+"%",y:s+"%",scale:r,easing:"linear"})):(o=this.transform.left+t.deltaX/this.scrollerEl.offsetWidth*100,this.animation.animate({x:o+"%",easing:"linear"})))},t.prototype.panEnd=function(t){var e,i;!1!==this.panning&&(this.panning=!1,this.trigger("panEnd"),1===this.transform.scale&&!1===this.pinching&&(e=this.getPosition(),i=t.overallVelocityX,Math.abs(i)>=this.swipeVelocity&&Math.abs(t.deltaX)>=this.swipeThreshold&&(t.offsetDirection===r.DIRECTION_LEFT?this.next({velocity:i,duration:this.navigationPanDuration}):t.offsetDirection===r.DIRECTION_RIGHT&&this.prev({velocity:i,duration:this.navigationPanDuration})),e===this.getPosition()&&(this.animation.animate({x:this.transform.left+"%",duration:this.navigationPanDuration}),this.trigger("attemptedNavigation",{position:this.getPosition()}))))},t.prototype.pinchStart=function(t){this.getActivePageSpread().isZoomable()&&(this.pinching=!0,this.el.setAttribute("data-pinching",!0),this.startTransform.scale=this.transform.scale)},t.prototype.pinchMove=function(t){!1!==this.pinching&&this.zoomTo({x:t.center.x,y:t.center.y,scale:this.startTransform.scale*t.scale,bounds:!1,easing:"linear"})},t.prototype.pinchEnd=function(t){var e,i,n;!1!==this.pinching&&(e=this.getActivePageSpread().getMaxZoomScale(),n=Math.max(1,Math.min(this.transform.scale,e)),i=this.getPosition(),1===this.startTransform.scale&&n>1?this.trigger("zoomedIn",{position:i}):this.startTransform.scale>1&&1===n&&this.trigger("zoomedOut",{position:i}),this.zoomTo({x:t.center.x,y:t.center.y,scale:n,duration:this.zoomDuration},function(t){return function(){t.pinching=!1,t.el.setAttribute("data-pinching",!1)}}(this)))},t.prototype.press=function(t){this.trigger("pressed",this.getCoordinateInfo(t.center.x,t.center.y,this.getActivePageSpread()))},t.prototype.singletap=function(t){var e,i,n,r,o,s,a,p;e=this.getActivePageSpread(),i=this.getCoordinateInfo(t.center.x,t.center.y,e),n=1===this.tap.count,clearTimeout(this.tap.timeout),n?(this.tap.count=0,this.trigger("doubleClicked",i),e.isZoomable()&&(r=e.getMaxZoomScale(),s=(p=this.transform.scale>1)?1:r,a=p?"zoomedOut":"zoomedIn",o=this.getPosition(),this.zoomTo({x:t.center.x,y:t.center.y,scale:s,duration:this.zoomDuration},function(t){return function(){t.trigger(a,{position:o})}}(this)))):(this.tap.count++,this.tap.timeout=setTimeout(function(t){return function(){t.tap.count=0,t.trigger("clicked",i)}}(this),this.tap.delay))},t.prototype.touchStart=function(t){this.getActivePageSpread().isScrollable()||t.preventDefault()},t.prototype.touchEnd=function(t){t.preventDefault()},t.prototype.resize=function(){var t,e;this.transform.scale>1&&(e=this.getPosition(),t=this.getActivePageSpread(),this.transform.left=this.getLeftTransformFromPageSpread(e,t),this.transform.top=0,this.transform.scale=1,this.zoomTo({x:this.transform.left,y:this.transform.top,scale:this.transform.scale,duration:0}),this.trigger("zoomedOut",{position:e}))},t}(),o.mixin(a),e.exports=a},{"./animation":1,"./page_spread":2,hammerjs:4,microevent:5}],4:[function(t,e,i){!function(t,i,n,r){function o(t,e,i){return setTimeout(h(t,i),e)}function s(t,e,i){return!!Array.isArray(t)&&(a(t,i[e],i),!0)}function a(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==r)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function p(e,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,r,n),e.apply(this,arguments)}}function u(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&ct(n,i)}function h(t,e){return function(){return t.apply(e,arguments)}}function c(t,e){return typeof t==gt?t.apply(e?e[0]||r:r,e):t}function l(t,e){return t===r?e:t}function d(t,e,i){a(m(e),function(e){t.addEventListener(e,i,!1)})}function g(t,e,i){a(m(e),function(e){t.removeEventListener(e,i,!1)})}function f(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function v(t,e){return t.indexOf(e)>-1}function m(t){return t.trim().split(/\s+/g)}function y(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function b(t){return Array.prototype.slice.call(t,0)}function S(t,e,i){for(var n=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];y(r,s)<0&&n.push(t[o]),r[o]=s,o++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function w(t,e){for(var i,n,o=e[0].toUpperCase()+e.slice(1),s=0;s<lt.length;){if(i=lt[s],(n=i?i+o:e)in t)return n;s++}return r}function E(){return St++}function T(e){var i=e.ownerDocument||e;return i.defaultView||i.parentWindow||t}function k(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){c(t.options.enable,[t])&&i.handler(e)},this.init()}function P(t){var e=t.options.inputClass;return new(e||(Tt?U:kt?V:Et?j:q))(t,_)}function _(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,o=e&_t&&n-r==0,s=e&(Ct|It)&&n-r==0;i.isFirst=!!o,i.isFinal=!!s,o&&(t.session={}),i.eventType=e,x(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function x(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=L(e)),r>1&&!i.firstMultiple?i.firstMultiple=L(e):1===r&&(i.firstMultiple=!1);var o=i.firstInput,s=i.firstMultiple,a=s?s.center:o.center,p=e.center=A(n);e.timeStamp=mt(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=M(a,p),e.distance=z(a,p),C(i,e),e.offsetDirection=N(e.deltaX,e.deltaY);var u=O(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=u.x,e.overallVelocityY=u.y,e.overallVelocity=vt(u.x)>vt(u.y)?u.x:u.y,e.scale=s?R(s.pointers,n):1,e.rotation=s?D(s.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,I(i,e);var h=t.element;f(e.srcEvent.target,h)&&(h=e.srcEvent.target),e.target=h}function C(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};e.eventType!==_t&&o.eventType!==Ct||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}function I(t,e){var i,n,o,s,a=t.lastInterval||e,p=e.timeStamp-a.timeStamp;if(e.eventType!=It&&(p>Pt||a.velocity===r)){var u=e.deltaX-a.deltaX,h=e.deltaY-a.deltaY,c=O(p,u,h);n=c.x,o=c.y,i=vt(c.x)>vt(c.y)?c.x:c.y,s=N(u,h),t.lastInterval=e}else i=a.velocity,n=a.velocityX,o=a.velocityY,s=a.direction;e.velocity=i,e.velocityX=n,e.velocityY=o,e.direction=s}function L(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:ft(t.pointers[i].clientX),clientY:ft(t.pointers[i].clientY)},i++;return{timeStamp:mt(),pointers:e,center:A(e),deltaX:t.deltaX,deltaY:t.deltaY}}function A(t){var e=t.length;if(1===e)return{x:ft(t[0].clientX),y:ft(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:ft(i/e),y:ft(n/e)}}function O(t,e,i){return{x:e/t||0,y:i/t||0}}function N(t,e){return t===e?Lt:vt(t)>=vt(e)?t<0?At:Ot:e<0?Nt:zt}function z(t,e,i){i||(i=qt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function M(t,e,i){i||(i=qt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function D(t,e){return M(e[1],e[0],Ut)+M(t[1],t[0],Ut)}function R(t,e){return z(e[0],e[1],Ut)/z(t[0],t[1],Ut)}function q(){this.evEl=Ft,this.evWin=Vt,this.pressed=!1,k.apply(this,arguments)}function U(){this.evEl=Wt,this.evWin=Bt,k.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function H(){this.evTarget=Zt,this.evWin=Kt,this.started=!1,k.apply(this,arguments)}function F(t,e){var i=b(t.touches),n=b(t.changedTouches);return e&(Ct|It)&&(i=S(i.concat(n),"identifier",!0)),[i,n]}function V(){this.evTarget=Jt,this.targetIds={},k.apply(this,arguments)}function X(t,e){var i=b(t.touches),n=this.targetIds;if(e&(_t|xt)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,o,s=b(t.changedTouches),a=[],p=this.target;if(o=i.filter(function(t){return f(t.target,p)}),e===_t)for(r=0;r<o.length;)n[o[r].identifier]=!0,r++;for(r=0;r<s.length;)n[s[r].identifier]&&a.push(s[r]),e&(Ct|It)&&delete n[s[r].identifier],r++;return a.length?[S(o.concat(a),"identifier",!0),a]:void 0}function j(){k.apply(this,arguments);var t=h(this.handler,this);this.touch=new V(this.manager,t),this.mouse=new q(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function W(t,e){t&_t?(this.primaryTouch=e.changedPointers[0].identifier,B.call(this,e)):t&(Ct|It)&&B.call(this,e)}function B(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout(function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)},Qt)}}function Y(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],o=Math.abs(e-r.x),s=Math.abs(i-r.y);if(o<=$t&&s<=$t)return!0}return!1}function Z(t,e){this.manager=t,this.set(e)}function K(t){if(v(t,re))return re;var e=v(t,oe),i=v(t,se);return e&&i?re:e||i?e?oe:se:v(t,ne)?ne:ie}function G(t){this.options=ct({},this.defaults,t||{}),this.id=E(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=pe,this.simultaneous={},this.requireFail=[]}function J(t){return t&de?"cancel":t&ce?"end":t&he?"move":t&ue?"start":""}function Q(t){return t==zt?"down":t==Nt?"up":t==At?"left":t==Ot?"right":""}function $(t,e){var i=e.manager;return i?i.get(t):t}function tt(){G.apply(this,arguments)}function et(){tt.apply(this,arguments),this.pX=null,this.pY=null}function it(){tt.apply(this,arguments)}function nt(){G.apply(this,arguments),this._timer=null,this._input=null}function rt(){tt.apply(this,arguments)}function ot(){tt.apply(this,arguments)}function st(){G.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function at(t,e){return e=e||{},e.recognizers=l(e.recognizers,at.defaults.preset),new pt(t,e)}function pt(t,e){this.options=ct({},at.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=P(this),this.touchAction=new Z(this,this.options.touchAction),ut(this,!0),a(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ut(t,e){var i=t.element;if(i.style){var n;a(t.options.cssProps,function(r,o){n=w(i.style,o),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={})}}function ht(t,e){var n=i.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}var ct,lt=["","webkit","Moz","MS","ms","o"],dt=i.createElement("div"),gt="function",ft=Math.round,vt=Math.abs,mt=Date.now;ct="function"!=typeof Object.assign?function(t){if(t===r||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==r&&null!==n)for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e}:Object.assign;var yt=p(function(t,e,i){for(var n=Object.keys(e),o=0;o<n.length;)(!i||i&&t[n[o]]===r)&&(t[n[o]]=e[n[o]]),o++;return t},"extend","Use `assign`."),bt=p(function(t,e){return yt(t,e,!0)},"merge","Use `assign`."),St=1,wt=/mobile|tablet|ip(ad|hone|od)|android/i,Et="ontouchstart"in t,Tt=w(t,"PointerEvent")!==r,kt=Et&&wt.test(navigator.userAgent),Pt=25,_t=1,xt=2,Ct=4,It=8,Lt=1,At=2,Ot=4,Nt=8,zt=16,Mt=At|Ot,Dt=Nt|zt,Rt=Mt|Dt,qt=["x","y"],Ut=["clientX","clientY"];k.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(T(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(T(this.element),this.evWin,this.domHandler)}};var Ht={mousedown:_t,mousemove:xt,mouseup:Ct},Ft="mousedown",Vt="mousemove mouseup";u(q,k,{handler:function(t){var e=Ht[t.type];e&_t&&0===t.button&&(this.pressed=!0),e&xt&&1!==t.which&&(e=Ct),this.pressed&&(e&Ct&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var Xt={pointerdown:_t,pointermove:xt,pointerup:Ct,pointercancel:It,pointerout:It},jt={2:"touch",3:"pen",4:"mouse",5:"kinect"},Wt="pointerdown",Bt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Wt="MSPointerDown",Bt="MSPointerMove MSPointerUp MSPointerCancel"),u(U,k,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=Xt[n],o=jt[t.pointerType]||t.pointerType,s="touch"==o,a=y(e,t.pointerId,"pointerId");r&_t&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):r&(Ct|It)&&(i=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),i&&e.splice(a,1))}});var Yt={touchstart:_t,touchmove:xt,touchend:Ct,touchcancel:It},Zt="touchstart",Kt="touchstart touchmove touchend touchcancel";u(H,k,{handler:function(t){var e=Yt[t.type];if(e===_t&&(this.started=!0),this.started){var i=F.call(this,t,e);e&(Ct|It)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var Gt={touchstart:_t,touchmove:xt,touchend:Ct,touchcancel:It},Jt="touchstart touchmove touchend touchcancel";u(V,k,{handler:function(t){var e=Gt[t.type],i=X.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}});var Qt=2500,$t=25;u(j,k,{handler:function(t,e,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)W.call(this,e,i);else if(r&&Y.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var te=w(dt.style,"touchAction"),ee=te!==r,ie="auto",ne="manipulation",re="none",oe="pan-x",se="pan-y",ae=function(){if(!ee)return!1;var e={},i=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!i||t.CSS.supports("touch-action",n)}),e}();Z.prototype={set:function(t){"compute"==t&&(t=this.compute()),ee&&this.manager.element.style&&ae[t]&&(this.manager.element.style[te]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return a(this.manager.recognizers,function(e){c(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),K(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,r=v(n,re)&&!ae[re],o=v(n,se)&&!ae[se],s=v(n,oe)&&!ae[oe];if(r){var a=1===t.pointers.length,p=t.distance<2,u=t.deltaTime<250;if(a&&p&&u)return}if(!s||!o)return r||o&&i&Mt||s&&i&Dt?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var pe=1,ue=2,he=4,ce=8,le=ce,de=16;G.prototype={defaults:{},set:function(t){return ct(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(s(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=$(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return s(t,"dropRecognizeWith",this)?this:(t=$(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(s(t,"requireFailure",this))return this;var e=this.requireFail;return t=$(t,this),-1===y(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(s(t,"dropRequireFailure",this))return this;t=$(t,this);var e=y(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(e,t)}var i=this,n=this.state;n<ce&&e(i.options.event+J(n)),e(i.options.event),t.additionalEvent&&e(t.additionalEvent),n>=ce&&e(i.options.event+J(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|pe)))return!1;t++}return!0},recognize:function(t){var e=ct({},t);if(!c(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(le|de|32)&&(this.state=pe),this.state=this.process(e),this.state&(ue|he|ce|de)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},u(tt,G,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(ue|he),r=this.attrTest(t);return n&&(i&It||!r)?e|de:n||r?i&Ct?e|ce:e&ue?e|he:ue:32}}),u(et,tt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Rt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Mt&&e.push(se),t&Dt&&e.push(oe),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&Mt?(r=0===o?Lt:o<0?At:Ot,i=o!=this.pX,n=Math.abs(t.deltaX)):(r=0===s?Lt:s<0?Nt:zt,i=s!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return tt.prototype.attrTest.call(this,t)&&(this.state&ue||!(this.state&ue)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Q(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),u(it,tt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[re]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ue)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),u(nt,G,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ie]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(Ct|It)&&!r)this.reset();else if(t.eventType&_t)this.reset(),this._timer=o(function(){this.state=le,this.tryEmit()},e.time,this);else if(t.eventType&Ct)return le;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===le&&(t&&t.eventType&Ct?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=mt(),this.manager.emit(this.options.event,this._input)))}}),u(rt,tt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[re]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ue)}}),u(ot,tt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Mt|Dt,pointers:1},getTouchAction:function(){return et.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Mt|Dt)?e=t.overallVelocity:i&Mt?e=t.overallVelocityX:i&Dt&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&vt(e)>this.options.velocity&&t.eventType&Ct},emit:function(t){var e=Q(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),u(st,G,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ne]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&_t&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=Ct)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||z(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=o(function(){this.state=le,this.tryEmit()},e.interval,this),ue):le}return 32},failTimeout:function(){return this._timer=o(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==le&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),at.VERSION="2.0.7",at.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[rt,{enable:!1}],[it,{enable:!1},["rotate"]],[ot,{direction:Mt}],[et,{direction:Mt},["swipe"]],[st],[st,{event:"doubletap",taps:2},["tap"]],[nt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};pt.prototype={set:function(t){return ct(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&le)&&(r=e.curRecognizer=null);for(var o=0;o<n.length;)i=n[o],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(ue|he|ce)&&(r=e.curRecognizer=i),o++}},get:function(t){if(t instanceof G)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(s(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(s(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=y(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==r&&e!==r){var i=this.handlers;return a(m(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==r){var i=this.handlers;return a(m(t),function(t){e?i[t]&&i[t].splice(y(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&ht(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&ut(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ct(at,{INPUT_START:_t,INPUT_MOVE:xt,INPUT_END:Ct,INPUT_CANCEL:It,STATE_POSSIBLE:pe,STATE_BEGAN:ue,STATE_CHANGED:he,STATE_ENDED:ce,STATE_RECOGNIZED:le,STATE_CANCELLED:de,STATE_FAILED:32,DIRECTION_NONE:Lt,DIRECTION_LEFT:At,DIRECTION_RIGHT:Ot,DIRECTION_UP:Nt,DIRECTION_DOWN:zt,DIRECTION_HORIZONTAL:Mt,DIRECTION_VERTICAL:Dt,DIRECTION_ALL:Rt,Manager:pt,Input:k,TouchAction:Z,TouchInput:V,MouseInput:q,PointerEventInput:U,TouchMouseInput:j,SingleTouchInput:H,Recognizer:G,AttrRecognizer:tt,Tap:st,Pan:et,Swipe:ot,Pinch:it,Rotate:rt,Press:nt,on:d,off:g,each:a,merge:bt,extend:yt,assign:ct,inherit:u,bindFn:h,prefixed:w}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=at,void 0!==e&&e.exports?e.exports=at:t.Hammer=at}(window,document)},{}],5:[function(t,e,i){var n=function(){};n.prototype={bind:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},unbind:function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(t){for(var e=["bind","unbind","trigger"],i=0;i<e.length;i++)t.prototype[e[i]]=n.prototype[e[i]]},void 0!==e&&"exports"in e&&(e.exports=n)},{}]},{},[3])(3)})});tt=o,et=rt,nt=v,it=function(){function t(t,e){null==e&&(e={}),this.options=this.makeOptions(e,this.defaults),this.pageId=this.getOption("pageId"),this.els={root:t,pages:t.querySelector(".sgn-pp__pages"),verso:t.querySelector(".verso")},this.pageMode=this.getPageMode(),this.pageSpreads=new et({pages:this.getOption("pages"),maxZoomScale:this.getOption("pageSpreadMaxZoomScale"),width:this.getOption("pageSpreadWidth")}),this.pageSpreads.bind("pageLoaded",this.pageLoaded.bind(this)),this.pageSpreads.bind("pagesLoaded",this.pagesLoaded.bind(this)),this.setColor(this.getOption("color")),this.els.pages.parentNode.insertBefore(this.pageSpreads.update(this.pageMode).getFrag(),this.els.pages),this.verso=this.createVerso(),this.bind("started",this.start.bind(this)),this.bind("destroyed",this.destroy.bind(this))}return t.prototype.defaults={pages:[],pageSpreadWidth:100,pageSpreadMaxZoomScale:4,idleDelay:1e3,resizeDelay:400,color:"#ffffff"},t.prototype.start=function(){this.getVerso().start(),this.visibilityChangeListener=this.visibilityChange.bind(this),this.resizeListener=nt.util.throttle(this.resize,this.getOption("resizeDelay"),this),this.unloadListener=this.unload.bind(this),document.addEventListener("visibilitychange",this.visibilityChangeListener,!1),window.addEventListener("resize",this.resizeListener,!1),window.addEventListener("beforeunload",this.unloadListener,!1),this.els.root.setAttribute("data-started",""),this.els.root.setAttribute("tabindex","-1"),this.els.root.focus()},t.prototype.destroy=function(){this.getVerso().destroy(),document.removeEventListener("visibilitychange",this.visibilityChangeListener,!1),window.removeEventListener("resize",this.resizeListener,!1)},t.prototype.makeOptions=function(t,e){var i,n,r;n={};for(i in t)n[i]=null!=(r=t[i])?r:e[i];return n},t.prototype.getOption=function(t){return this.options[t]},t.prototype.setColor=function(t){this.els.root.dataset.colorBrightness=nt.util.getColorBrightness(t),this.els.root.style.backgroundColor=t},t.prototype.createVerso=function(){var t,e;return t=ot,(e=new t(this.els.verso,{pageId:this.pageId})).pageSpreads.forEach(this.overridePageSpreadContentRect.bind(this)),e.bind("beforeNavigation",this.beforeNavigation.bind(this)),e.bind("afterNavigation",this.afterNavigation.bind(this)),e.bind("attemptedNavigation",this.attemptedNavigation.bind(this)),e.bind("clicked",this.clicked.bind(this)),e.bind("doubleClicked",this.doubleClicked.bind(this)),e.bind("pressed",this.pressed.bind(this)),e.bind("panStart",this.panStart.bind(this)),e.bind("panEnd",this.panEnd.bind(this)),e.bind("zoomedIn",this.zoomedIn.bind(this)),e.bind("zoomedOut",this.zoomedOut.bind(this)),e},t.prototype.getVerso=function(){return this.verso},t.prototype.getContentRect=function(t){var e,i,n,r,o,s,a,p,u,h,c;return h={top:0,left:0,right:0,bottom:0,width:0,height:0},a=t.getPageEls(),s=a[0],o=a.length,c=this.getVerso().transform.scale,u=s.offsetWidth*o*c,p=s.offsetHeight*c,r=+s.dataset.height/(+s.dataset.width*o),e=p,i=e/r,i=Math.min(u,i),e=i*r,n={top:s.offsetTop,left:s.offsetLeft},h.width=i,h.height=e,h.top=n.top+(p-e)/2,h.left=n.left+(u-i)/2,h.right=h.width+h.left,h.bottom=h.height+h.top,h},t.prototype.formatProgressLabel=function(t){var e,i,n,r,o;return r=null!=(o=null!=t?t.options.pages:void 0)?o:[],i=r.map(function(t){return t.id}),n=r.map(function(t){return t.label}),e=this.getOption("pages").length,i.length>0?n.join("-")+" / "+e:null},t.prototype.renderPageSpreads=function(){return this.getVerso().pageSpreads.forEach(function(t){return function(e){var i,n;n=e.getVisibility(),null!=(i=t.pageSpreads.get(e.getId()))&&("visible"===n&&!1===i.contentsRendered&&setTimeout(i.renderContents.bind(i),0),"gone"===n&&!0===i.contentsRendered&&setTimeout(i.clearContents.bind(i),0))}}(this)),this},t.prototype.findPage=function(t){return nt.util.find(this.getOption("pages"),function(e){return e.id===t})},t.prototype.pageLoaded=function(t){this.trigger("pageLoaded",t)},t.prototype.pagesLoaded=function(t){this.trigger("pagesLoaded",t)},t.prototype.beforeNavigation=function(t){var e,i,n,r,o,s;n=t.newPosition,s=this.getVerso().getPageSpreadFromPosition(n),e=this.pageSpreads.get(s.getId()),r=(n+1)/(i=this.getVerso().getPageSpreadCount())*100,o=this.formatProgressLabel(e),this.els.root.setAttribute("data-navigating",!0),this.renderPageSpreads(),this.resetIdleTimer(),this.startIdleTimer(),this.trigger("beforeNavigation",{verso:t,pageSpread:e,progress:r,progressLabel:o,pageSpreadCount:i})},t.prototype.afterNavigation=function(t){var e,i,n;i=t.newPosition,n=this.getVerso().getPageSpreadFromPosition(i),e=this.pageSpreads.get(n.getId()),this.els.root.setAttribute("data-navigating",!1),this.trigger("afterNavigation",{verso:t,pageSpread:e})},t.prototype.attemptedNavigation=function(t){this.trigger("attemptedNavigation",{verso:t})},t.prototype.clicked=function(t){var e,i;t.isInsideContent&&(i=t.pageEl.dataset.id,e=this.findPage(i),this.trigger("clicked",{verso:t,page:e}))},t.prototype.doubleClicked=function(t){var e,i;t.isInsideContent&&(i=t.pageEl.dataset.id,e=this.findPage(i),this.trigger("doubleClicked",{verso:t,page:e}))},t.prototype.pressed=function(t){var e,i;t.isInsideContent&&(i=t.pageEl.dataset.id,e=this.findPage(i),this.trigger("pressed",{verso:t,page:e}))},t.prototype.panStart=function(){this.resetIdleTimer(),this.trigger("panStart",{scale:this.getVerso().transform.scale})},t.prototype.panEnd=function(){this.startIdleTimer(),this.trigger("panEnd")},t.prototype.zoomedIn=function(t){var e,i,n;i=t.position,n=this.getVerso().getPageSpreadFromPosition(i),null!=(e=this.pageSpreads.get(n.getId()))&&e.zoomIn(),this.els.root.setAttribute("data-zoomed-in",!0),this.trigger("zoomedIn",{verso:t,pageSpread:e})},t.prototype.zoomedOut=function(t){var e,i,n;i=t.position,n=this.getVerso().getPageSpreadFromPosition(i),null!=(e=this.pageSpreads.get(n.getId()))&&e.zoomOut(),this.els.root.setAttribute("data-zoomed-in",!1),this.trigger("zoomedOut",{verso:t,pageSpread:e})},t.prototype.getPageMode=function(){var t,e;return null==(t=this.getOption("pageMode"))&&(e=this.els.root.offsetWidth,t=this.els.root.offsetHeight>=e?"single":"double"),t},t.prototype.resetIdleTimer=function(){return clearTimeout(this.idleTimeout),this.els.root.setAttribute("data-idle",!1),this},t.prototype.startIdleTimer=function(){return this.idleTimeout=setTimeout(function(t){return function(){t.els.root.setAttribute("data-idle",!0)}}(this),this.getOption("idleDelay")),this},t.prototype.switchPageMode=function(t){var e,i,n,r,o,s;if(this.pageMode===t)return this;for(n=(s=this.getVerso()).getPageSpreadFromPosition(s.getPosition()).getPageIds(),o=this.getVerso().el.querySelectorAll(".sgn-pp__page-spread"),this.pageMode=t,this.pageSpreads.update(this.pageMode),e=0,i=o.length;e<i;e++)(r=o[e]).parentNode.removeChild(r);return this.els.pages.parentNode.insertBefore(this.pageSpreads.getFrag(),this.els.pages),s.refresh(),s.navigateTo(s.getPageSpreadPositionFromPageId(n[0]),{duration:0}),s.pageSpreads.forEach(this.overridePageSpreadContentRect.bind(this)),this},t.prototype.overridePageSpreadContentRect=function(t){if("page"===t.getType())return t.getContentRect=function(e){return function(){return e.getContentRect(t)}}(this)},t.prototype.visibilityChange=function(){var t,e;e=this.getVerso().getPageSpreadFromPosition(this.getVerso().getPosition()),t=!0===document.hidden?"disappeared":"appeared",this.trigger(t,{pageSpread:this.pageSpreads.get(e.id)})},t.prototype.resize=function(){var t;t=this.getPageMode(),null==this.getOption("pageMode")&&t!==this.pageMode?this.switchPageMode(t):this.trigger("resized")},t.prototype.unload=function(){this.trigger("disappeared")},t}(),tt.mixin(it);var st,at,pt,ut=it;st=o,at=u,pt=function(){function t(){this.currentPageSpreadId=null,this.pageSpreadsLoaded={},this.cache={},this.bind("hotspotsReceived",this.hotspotsReceived.bind(this)),this.bind("afterNavigation",this.afterNavigation.bind(this)),this.bind("pagesLoaded",this.pagesLoaded.bind(this)),this.bind("resized",this.resized.bind(this))}return t.prototype.renderHotspots=function(t){var e,i,n,r,o,s,a,p,u,h,c,l;for(n=document.createDocumentFragment(),e=t.versoPageSpread.getContentRect(),a=0,u=(s=(h=t.pageSpread.getEl()).querySelectorAll(".sgn-pp__hotspot")).length;a<u;a++)(o=s[a]).parentNode.removeChild(o);l=t.hotspots;for(p in l)r=l[p],c=this.getPosition(t.pages,t.ratio,r),i=this.renderHotspot(r,c,e),n.appendChild(i);return h.appendChild(n),this},t.prototype.renderHotspot=function(t,e,i){var n,r,o,s,a,p;return n=document.createElement("div"),a=Math.round(i.height/100*e.top),o=Math.round(i.width/100*e.left),p=Math.round(i.width/100*e.width),r=Math.round(i.height/100*e.height),a+=Math.round(i.top),o+=Math.round(i.left),n.className="sgn-pp__hotspot verso__overlay",null!=t.id&&n.setAttribute("data-id",t.id),null!=t.type&&n.setAttribute("data-type",t.type),n.innerHTML=at.render(null!=(s=t.template)?s:"",t),n.style.top=a+"px",n.style.left=o+"px",n.style.width=p+"px",n.style.height=r+"px",n},t.prototype.getPosition=function(t,e,i){var n,r,o,s,a,p,u,h;s=null,a=null,r=null,o=null,u=t.map(function(t){return t.pageNumber});for(p in i.locations)-1!==u.indexOf(+p)&&i.locations[p].forEach(function(e){var i,n;if(i=e[0],n=e[1],t[1]&&u[1]===+p&&(i+=1),i/=t.length,null==s&&(s=r=i,a=o=n),i<s&&(s=i),i>r&&(r=i),n<a&&(a=n),n>o)return o=n});return h=r-s,n=o-a,{top:a/e*100,left:100*s,width:100*h,height:n/e*100}},t.prototype.requestHotspots=function(t,e){this.trigger("hotspotsRequested",{id:t,pages:e})},t.prototype.hotspotsReceived=function(t){var e;e=t.pageSpread.getId(),this.setCache(e,t),this.renderHotspots(t)},t.prototype.getCache=function(t){return this.cache[t]},t.prototype.setCache=function(t,e){return this.cache[t]=e,this},t.prototype.afterNavigation=function(t){var e;null!=t.pageSpread&&(e=t.pageSpread.getId(),this.currentPageSpreadId=e,this.pageSpreadsLoaded[e]&&this.requestHotspots(e,t.pageSpread.getPages()))},t.prototype.pagesLoaded=function(t){this.pageSpreadsLoaded[t.pageSpreadId]=!0,this.currentPageSpreadId===t.pageSpreadId&&this.requestHotspots(t.pageSpreadId,t.pages)},t.prototype.resized=function(t){var e;null!=(e=this.getCache(this.currentPageSpreadId))&&this.renderHotspots(e)},t}(),st.mixin(pt);var ht,ct,lt,dt,gt=pt,ft={ESC:27,ARROW_RIGHT:39,ARROW_LEFT:37,SPACE:32,NUMBER_ONE:49};ht=o,lt=v,dt=ft,ct=function(){function t(t,e){this.options=null!=e?e:{},this.els={root:t,progress:t.querySelector(".sgn-pp__progress"),progressBar:t.querySelector(".sgn-pp-progress__bar"),progressLabel:t.querySelector(".sgn-pp__progress-label"),prevControl:t.querySelector(".sgn-pp__control[data-direction=prev]"),nextControl:t.querySelector(".sgn-pp__control[data-direction=next]")},this.keyDownListener=lt.util.throttle(this.keyDown,150,this),this.mouseMoveListener=lt.util.throttle(this.mouseMove,50,this),!0===this.options.keyboard&&this.els.root.addEventListener("keydown",this.keyDownListener,!1),this.els.root.addEventListener("mousemove",this.mouseMoveListener,!1),null!=this.els.prevControl&&this.els.prevControl.addEventListener("click",this.prevClicked.bind(this),!1),null!=this.els.nextControl&&this.els.nextControl.addEventListener("click",this.nextClicked.bind(this),!1),this.bind("beforeNavigation",this.beforeNavigation.bind(this))}return t.prototype.destroy=function(){this.els.root.removeEventListener("keydown",this.keyDownListener),this.els.root.removeEventListener("mousemove",this.mouseMoveListener)},t.prototype.beforeNavigation=function(t){var e;e="string"==typeof t.progressLabel&&t.progressLabel.length>0,null!=this.els.progress&&null!=this.els.progressBar&&(this.els.progressBar.style.width=t.progress+"%",!0===e?this.els.progress.classList.remove("sgn-pp--hidden"):this.els.progress.classList.add("sgn-pp--hidden")),null!=this.els.progressLabel&&(!0===e?(this.els.progressLabel.textContent=t.progressLabel,this.els.progressLabel.classList.remove("sgn-pp--hidden")):this.els.progressLabel.classList.add("sgn-pp--hidden")),null!=this.els.prevControl&&(0===t.verso.newPosition?this.els.prevControl.classList.add("sgn-pp--hidden"):this.els.prevControl.classList.remove("sgn-pp--hidden")),null!=this.els.nextControl&&(t.verso.newPosition===t.pageSpreadCount-1?this.els.nextControl.classList.add("sgn-pp--hidden"):this.els.nextControl.classList.remove("sgn-pp--hidden"))},t.prototype.prevClicked=function(t){t.preventDefault(),this.trigger("prev")},t.prototype.nextClicked=function(t){t.preventDefault(),this.trigger("next")},t.prototype.keyDown=function(t){var e;e=t.keyCode,dt.ARROW_LEFT===e?this.trigger("prev",{duration:0}):dt.ARROW_RIGHT===e||dt.SPACE===e?this.trigger("next",{duration:0}):dt.NUMBER_ONE===e&&this.trigger("first",{duration:0})},t.prototype.mouseMove=function(){this.els.root.dataset.mouseMoving=!0,clearTimeout(this.mouseMoveTimeout),this.mouseMoveTimeout=setTimeout(function(t){return function(){t.els.root.dataset.mouseMoving=!1}}(this),4e3)},t}(),ht.mixin(ct);var vt,mt,yt=ct,bt=function(t,e){return function(){return t.apply(e,arguments)}};vt=o,mt=function(){function t(){this.doubleClicked=bt(this.doubleClicked,this),this.hidden=!0,this.pageSpread=null,this.bind("appeared",this.appeared.bind(this)),this.bind("disappeared",this.disappeared.bind(this)),this.bind("beforeNavigation",this.beforeNavigation.bind(this)),this.bind("afterNavigation",this.afterNavigation.bind(this)),this.bind("attemptedNavigation",this.attemptedNavigation.bind(this)),this.bind("clicked",this.clicked.bind(this)),this.bind("doubleClicked",this.doubleClicked.bind(this)),this.bind("pressed",this.pressed.bind(this)),this.bind("panStart",this.panStart.bind(this)),this.bind("zoomedIn",this.zoomedIn.bind(this)),this.bind("zoomedOut",this.zoomedOut.bind(this)),this.bind("destroyed",this.destroy.bind(this)),this.trackOpened(),this.trackAppeared()}return t.prototype.destroy=function(){this.pageSpreadDisappeared(),this.trackDisappeared()},t.prototype.trackEvent=function(t,e){null==e&&(e={}),this.trigger("trackEvent",{type:t,properties:e})},t.prototype.trackOpened=function(t){return this.trackEvent("paged-publication-opened",t),this},t.prototype.trackAppeared=function(t){return this.trackEvent("paged-publication-appeared",t),this},t.prototype.trackDisappeared=function(t){return this.trackEvent("paged-publication-disappeared",t),this},t.prototype.trackPageClicked=function(t){return this.trackEvent("paged-publication-page-clicked",t),this},t.prototype.trackPageDoubleClicked=function(t){return this.trackEvent("paged-publication-page-double-clicked",t),this},t.prototype.trackPageLongPressed=function(t){return this.trackEvent("paged-publication-page-long-pressed",t),this},t.prototype.trackPageHotspotsClicked=function(t){return this.trackEvent("paged-publication-page-hotspots-clicked",t),this},t.prototype.trackPageSpreadAppeared=function(t){return this.trackEvent("paged-publication-page-spread-appeared",t),this},t.prototype.trackPageSpreadDisappeared=function(t){return this.trackEvent("paged-publication-page-spread-disappeared",t),this},t.prototype.trackPageSpreadZoomedIn=function(t){return this.trackEvent("paged-publication-page-spread-zoomed-in",t),this},t.prototype.trackPageSpreadZoomedOut=function(t){return this.trackEvent("paged-publication-page-spread-zoomed-out",t),this},t.prototype.appeared=function(t){this.trackAppeared(),this.pageSpreadAppeared(t.pageSpread)},t.prototype.disappeared=function(){this.pageSpreadDisappeared(),this.trackDisappeared()},t.prototype.beforeNavigation=function(){this.pageSpreadDisappeared()},t.prototype.afterNavigation=function(t){this.pageSpreadAppeared(t.pageSpread)},t.prototype.attemptedNavigation=function(t){this.pageSpreadAppeared(t.pageSpread)},t.prototype.clicked=function(t){var e;null!=t.page&&(e={pageNumber:t.page.pageNumber,x:t.verso.pageX,y:t.verso.pageY},this.trackPageClicked({pagedPublicationPage:e}),t.verso.overlayEls.length>0&&this.trackPageHotspotsClicked({pagedPublicationPage:e}))},t.prototype.doubleClicked=function(t){null!=t.page&&this.trackPageDoubleClicked({pagedPublicationPage:{pageNumber:t.page.pageNumber,x:t.verso.pageX,y:t.verso.pageY}})},t.prototype.pressed=function(t){null!=t.page&&this.trackPageLongPressed({pagedPublicationPage:{pageNumber:t.page.pageNumber,x:t.verso.pageX,y:t.verso.pageY}})},t.prototype.panStart=function(t){1===t.scale&&this.pageSpreadDisappeared()},t.prototype.zoomedIn=function(t){null!=t.pageSpread&&this.trackPageSpreadZoomedIn({pagedPublicationPageSpread:{pageNumbers:t.pageSpread.getPages().map(function(t){return t.pageNumber})}})},t.prototype.zoomedOut=function(t){null!=t.pageSpread&&this.trackPageSpreadZoomedOut({pagedPublicationPageSpread:{pageNumbers:t.pageSpread.getPages().map(function(t){return t.pageNumber})}})},t.prototype.pageSpreadAppeared=function(t){null!=t&&!0===this.hidden&&(this.pageSpread=t,this.trackPageSpreadAppeared({pagedPublicationPageSpread:{pageNumbers:t.getPages().map(function(t){return t.pageNumber})}}),this.hidden=!1)},t.prototype.pageSpreadDisappeared=function(){null!=this.pageSpread&&!1===this.hidden&&(this.trackPageSpreadDisappeared({pagedPublicationPageSpread:{pageNumbers:this.pageSpread.getPages().map(function(t){return t.pageNumber})}}),this.hidden=!0,this.pageSpread=null)},t}(),vt.mixin(mt);var St,wt,Et=mt;St=o,wt=function(){function t(){this.bind("eventTracked",this.eventTracked.bind(this)),this.zoomedIn=!1,this.appearedAt=null}return t.prototype.trackEvent=function(t){this.trigger("trackEvent",t)},t.prototype.eventTracked=function(t){"paged-publication-page-spread-appeared"===t.type&&(this.appearedAt=Date.now()),"paged-publication-page-spread-disappeared"===t.type?this.trigger("trackEvent",{type:this.zoomedIn?"zoom":"view",ms:Date.now()-this.appearedAt,orientation:this.getOrientation(),pages:t.properties.pagedPublicationPageSpread.pageNumbers}):"paged-publication-page-spread-zoomed-in"===t.type?(this.trigger("trackEvent",{type:"view",ms:this.getDuration(),orientation:this.getOrientation(),pages:t.properties.pagedPublicationPageSpread.pageNumbers}),this.zoomedIn=!0,this.appearedAt=Date.now()):"paged-publication-page-spread-zoomed-out"===t.type&&(this.trigger("trackEvent",{type:"zoom",ms:this.getDuration(),orientation:this.getOrientation(),pages:t.properties.pagedPublicationPageSpread.pageNumbers}),this.zoomedIn=!1,this.appearedAt=Date.now())},t.prototype.getOrientation=function(){return window.innerWidth>=window.innerHeight?"landscape":"portrait"},t.prototype.getDuration=function(){return Date.now()-this.appearedAt},t}(),St.mixin(wt);var Tt,kt,Pt,_t,xt,Ct,It,Lt;Ct=o,It=v,kt=ut,_t=gt,Tt=yt,Pt=Et,xt=wt,Lt=function(){function t(t,e){this.el=t,this.options=null!=e?e:{},this._core=new kt(this.el,{id:this.options.id,pages:this.options.pages,pageSpreadWidth:this.options.pageSpreadWidth,pageSpreadMaxZoomScale:this.options.pageSpreadMaxZoomScale,idleDelay:this.options.idleDelay,resizeDelay:this.options.resizeDelay,color:this.options.color}),this._hotspots=new _t,this._controls=new Tt(this.el,{keyboard:this.options.keyboard}),this._eventTracking=new Pt,this._legacyEventTracking=new xt,this.viewSession=It.util.uuid(),this._setupEventListeners()}return t.prototype.start=function(){return this._core.trigger("started"),this},t.prototype.destroy=function(){return this._core.trigger("destroyed"),this._hotspots.trigger("destroyed"),this._controls.trigger("destroyed"),this._eventTracking.trigger("destroyed"),this.el.parentNode.removeChild(this.el),this},t.prototype.navigateTo=function(t,e){return this._core.getVerso().navigateTo(t,e),this},t.prototype.first=function(t){return this._core.getVerso().first(t),this},t.prototype.prev=function(t){return this._core.getVerso().prev(t),this},t.prototype.next=function(t){return this._core.getVerso().next(t),this},t.prototype.last=function(t){return this._core.getVerso().last(t),this},t.prototype._trackEvent=function(t){var e,i,n,r,o,s;o=t.type,n={pagedPublication:{id:["legacy",this.options.id],ownedBy:["legacy",this.options.ownedBy]}},e=this.options.eventTracker,r=t.properties;for(i in r)s=r[i],n[i]=s;null!=e&&e.trackEvent(o,n)},t.prototype._trackLegacyEvent=function(t){var e,i;i={},null!=(e=this.options.eventTracker)&&(i.latitude=e.location.latitude,i.longitude=e.location.longitude,null!=i.latitude&&(i.sensor=!0),It.CoreKit.request({geolocation:i,method:"post",url:"/v2/catalogs/"+this.options.id+"/collect",json:!0,body:{type:t.type,ms:t.ms,orientation:t.orientation,pages:t.pages.join(","),view_session:this.viewSession}}))},t.prototype._setupEventListeners=function(){this._eventTracking.bind("trackEvent",function(t){return function(e){t._trackEvent(e),t._legacyEventTracking.trigger("eventTracked",e)}}(this)),this._legacyEventTracking.bind("trackEvent",function(t){return function(e){t._trackLegacyEvent(e)}}(this)),this._controls.bind("prev",function(t){return function(e){t.prev(e)}}(this)),this._controls.bind("next",function(t){return function(e){t.next(e)}}(this)),this._controls.bind("first",function(t){return function(e){t.first(e)}}(this)),this._controls.bind("last",function(t){return function(e){t.last()}}(this)),this._hotspots.bind("hotspotsRequested",function(t){return function(e){t.trigger("hotspotsRequested",e)}}(this)),this._core.bind("appeared",function(t){return function(e){t._eventTracking.trigger("appeared",e),t.trigger("appeared",e)}}(this)),this._core.bind("disappeared",function(t){return function(e){t._eventTracking.trigger("disappeared",e),t.trigger("disappeared",e)}}(this)),this._core.bind("beforeNavigation",function(t){return function(e){t._eventTracking.trigger("beforeNavigation",e),t._controls.trigger("beforeNavigation",e),t.trigger("beforeNavigation",e)}}(this)),this._core.bind("afterNavigation",function(t){return function(e){t._eventTracking.trigger("afterNavigation",e),t.trigger("afterNavigation",e)}}(this)),this._core.bind("attemptedNavigation",function(t){return function(e){t._eventTracking.trigger("attemptedNavigation",e),t.trigger("attemptedNavigation",e)}}(this)),this._core.bind("clicked",function(t){return function(e){t._eventTracking.trigger("clicked",e),t.trigger("clicked",e)}}(this)),this._core.bind("doubleClicked",function(t){return function(e){t._eventTracking.trigger("doubleClicked",e),t.trigger("doubleClicked",e)}}(this)),this._core.bind("pressed",function(t){return function(e){t._eventTracking.trigger("pressed",e),t.trigger("pressed",e)}}(this)),this._core.bind("panStart",function(t){return function(e){t._eventTracking.trigger("panStart",e),t.trigger("panStart",e)}}(this)),this._core.bind("zoomedIn",function(t){return function(e){t._eventTracking.trigger("zoomedIn",e),t.trigger("zoomedIn",e)}}(this)),this._core.bind("zoomedOut",function(t){return function(e){t._eventTracking.trigger("zoomedOut",e),t.trigger("zoomedOut",e)}}(this)),this._core.bind("pageLoaded",function(t){return function(e){t._eventTracking.trigger("pageLoaded",e),t.trigger("pageLoaded",e)}}(this)),this._core.bind("afterNavigation",function(t){return function(e){t._hotspots.trigger("afterNavigation",e),t.trigger("afterNavigation",e)}}(this)),this._core.bind("pagesLoaded",function(t){return function(e){t._hotspots.trigger("pagesLoaded",e),t.trigger("pagesLoaded",e)}}(this)),this._core.bind("resized",function(t){return function(e){t._hotspots.trigger("resized"),t.trigger("resized",e)}}(this)),this.bind("hotspotsReceived",function(t){return function(e){t._hotspots.trigger("hotspotsReceived",{pageSpread:t._core.pageSpreads.get(e.id),versoPageSpread:It.util.find(t._core.getVerso().pageSpreads,function(t){return t.getId()===e.id}),ratio:e.ratio,pages:e.pages,hotspots:e.hotspots})}}(this))},t}(),Ct.mixin(Lt);var At,Ot,Nt,zt,Mt,Dt,Rt=Lt,qt=e(function(t){!function(){function e(t){return p||(p=t.matches?t.matches:t.webkitMatchesSelector?t.webkitMatchesSelector:t.mozMatchesSelector?t.mozMatchesSelector:t.msMatchesSelector?t.msMatchesSelector:t.oMatchesSelector?t.oMatchesSelector:a.matchesSelector)}function i(t,n,r){if("_root"==n)return r;if(t!==r)return e(t).call(t,n)?t:t.parentNode?(u++,i(t.parentNode,n,r)):void 0}function n(t,e,i,n){c[t.id]||(c[t.id]={}),c[t.id][e]||(c[t.id][e]={}),c[t.id][e][i]||(c[t.id][e][i]=[]),c[t.id][e][i].push(n)}function r(t,e,i,n){if(c[t.id])if(e)if(n||i)if(n){if(c[t.id][e][i])for(var r=0;r<c[t.id][e][i].length;r++)if(c[t.id][e][i][r]===n){c[t.id][e][i].splice(r,1);break}}else delete c[t.id][e][i];else c[t.id][e]={};else for(var o in c[t.id])c[t.id].hasOwnProperty(o)&&(c[t.id][o]={})}function o(t,e,n){if(c[t][n]){var r,o,s=e.target||e.srcElement,p={},h=0,d=0;u=0;for(r in c[t][n])c[t][n].hasOwnProperty(r)&&(o=i(s,r,l[t].element))&&a.matchesEvent(n,l[t].element,o,"_root"==r,e)&&(u++,c[t][n][r].match=o,p[u]=c[t][n][r]);for(e.stopPropagation=function(){e.cancelBubble=!0},h=0;h<=u;h++)if(p[h])for(d=0;d<p[h].length;d++){if(!1===p[h][d].call(p[h].match,e))return void a.cancel(e);if(e.cancelBubble)return}}}function s(t,e,i,s){if(this.element){t instanceof Array||(t=[t]),i||"function"!=typeof e||(i=e,e="_root");var p,u=this.id;for(p=0;p<t.length;p++)s?r(this,t[p],e,i):(c[u]&&c[u][t[p]]||a.addEvent(this,t[p],function(t){return function(e){o(u,e,t)}}(t[p])),n(this,t[p],e,i));return this}}function a(t,e){if(!(this instanceof a)){for(var i in l)if(l[i].element===t)return l[i];return h++,l[h]=new a(t,h),l[h]}this.element=t,this.id=e}var p,u=0,h=0,c={},l={};a.prototype.on=function(t,e,i){return s.call(this,t,e,i)},a.prototype.off=function(t,e,i){return s.call(this,t,e,i,!0)},a.matchesSelector=function(){},a.cancel=function(t){t.preventDefault(),t.stopPropagation()},a.addEvent=function(t,e,i){var n="blur"==e||"focus"==e;t.element.addEventListener(e,i,n)},a.matchesEvent=function(){return!0},t.exports&&(t.exports=a),window.Gator=a}()});Ot=o,At=qt,Nt=u,Dt='<div class="sgn-pp-hotspot-picker__background" data-close></div>\n<div class="sgn__popover" style="top: {{top}}px; left: {{left}}px;">\n    {{#header}}\n        <div class="sgn-popover__header">{{header}}</div>\n    {{/header}}\n    <div class="sgn-popover__content">\n        <ul>\n            {{#hotspots}}\n                <li data-id="{{id}}">\n                    <p>{{title}}</p>\n                    <p>{{subtitle}}</p>\n                </li>\n            {{/hotspots}}\n        </ul>\n    </div>\n</div>',Mt=ft,zt=function(){function t(t){this.options=null!=t?t:{},this.el=document.createElement("div"),this.resizeListener=this.resize.bind(this)}return t.prototype.render=function(){var t,e,i,n,r,o,s,a,p;return p=null!=(o=this.options.width)?o:100,t=this.options.header,null!=this.options.template&&(Dt=this.options.template),s=this.trigger.bind(this),a={header:t,hotspots:this.options.hotspots,top:this.options.y,left:this.options.x},this.el.className="sgn-pp__hotspot-picker",this.el.setAttribute("tabindex",-1),this.el.innerHTML=Nt.render(Dt,a),r=this.el.querySelector(".sgn__popover"),p=r.offsetWidth,e=r.offsetHeight,n=this.el.parentNode.offsetWidth,i=this.el.parentNode.offsetHeight,a.top+e>i&&(r.style.top=i-e+"px"),a.left+p>n&&(r.style.left=n-p+"px"),this.el.addEventListener("keyup",this.keyUp.bind(this)),At(this.el).on("click","[data-id]",function(){s("selected",{id:this.getAttribute("data-id")})}),At(this.el).on("click","[data-close]",this.destroy.bind(this)),window.addEventListener("resize",this.resizeListener,!1),this},t.prototype.destroy=function(){this.el.parentNode.removeChild(this.el),this.trigger("destroyed")},t.prototype.keyUp=function(t){t.keyCode===Mt.ESC&&this.destroy()},t.prototype.resize=function(){window.removeEventListener("resize",this.resizeListener),this.destroy()},t}(),Ot.mixin(zt);var Ut,Ht,Ft,Vt,Xt=zt;Ut=u,Ft=f,Vt='<div class="sgn__pp" style="height: 100%;">\n    <div class="verso">\n        <div class="verso__scroller">\n            <div class="sgn-pp__pages"></div>\n        </div>\n    </div>\n\n    {{#showProgressBar}}\n        <div class="sgn-pp__progress">\n            <div class="sgn-pp-progress__bar"></div>\n        </div>\n    {{/showProgressBar}}\n\n    {{#showProgressLabel}}\n        <div class="sgn-pp__progress-label"></div>\n    {{/showProgressLabel}}\n\n    {{#showControls}}\n        <a class="sgn-pp__control" href="#" role="button" data-direction="prev">&lsaquo;</a>\n        <a class="sgn-pp__control" href="#" role="button" data-direction="next">&rsaquo;</a>\n    {{/showControls}}\n</div>';var jt,Wt=Ht=function(){return function(t){var e,i,n,r,o;this.el=t,o=this.el.getAttribute("data-id"),i=this.el.getAttribute("data-hotspots"),n=this.el.getAttribute("data-progress-bar"),r=this.el.getAttribute("data-progress-label"),e=this.el.getAttribute("data-controls"),this.el.innerHTML=Ut.render(Vt,{showProgressBar:"true"===n,showProgressLabel:"true"===r,showControls:"true"===e}),Ft.PagedPublicationKit.initialize({el:this.el.querySelector(".sgn__pp"),id:o,eventTracker:Ft.config.get("eventTracker"),showHotspots:"true"===i},function(t,e){null==t&&e.start()})}}();jt=f;var Bt,Yt,Zt,Kt,Gt,Jt,Qt,$t,te,ee,ie={Viewer:Rt,HotspotPicker:Xt,Widget:Wt,initialize:function(t,e){var i,n,r,o,s,a,p,u,h,c,l;null==t&&(t={}),i={details:null,pages:null,hotspots:null},l=null,p={},a=[],s=null,n=function(e){jt.CoreKit.request({url:"/v2/catalogs/"+t.id},e)},o=function(e){jt.CoreKit.request({url:"/v2/catalogs/"+t.id+"/pages"},e)},r=function(e){jt.CoreKit.request({url:"/v2/catalogs/"+t.id+"/hotspots"},e)},h=function(){(l=new jt.PagedPublicationKit.Viewer(t.el,{id:t.id,ownedBy:i.details.dealer_id,color:"#"+i.details.branding.pageflip.color,keyboard:!0,eventTracker:t.eventTracker,pages:c(i.pages)})).bind("hotspotsRequested",function(t){a.push(t),u()}),l.bind("beforeNavigation",function(){null!=s&&s.destroy()}),l.bind("clicked",function(t){var e;1===(e=t.verso.overlayEls.map(function(t){return i.hotspots[t.getAttribute("data-id")]})).length?l.trigger("hotspotSelected",e[0]):e.length>1&&(p=e.filter(function(t){return"offer"===t.type}).map(function(t){return{id:t.id,title:t.offer.heading,subtitle:t.offer.pricing.currency+""+t.offer.pricing.price}}),(s=new jt.PagedPublicationKit.HotspotPicker({header:jt.i18n.t("paged_publication.hotspot_picker.header"),x:t.verso.x,y:t.verso.y,hotspots:p})).bind("selected",function(t){l.trigger("hotspotSelected",i.hotspots[t.id]),s.destroy()}),s.bind("destroyed",function(){s=null,l.el.focus()}),l.el.appendChild(s.el),s.render().el.focus())}),e(null,l,i)},c=function(t){return t.map(function(t,e){var i;return i=e+1,{id:"page"+i,label:i+"",pageNumber:i,images:{medium:t.view,large:t.zoom}}})},u=function(){l&&i.hotspots&&(a=a.filter(function(t){var e,n,r,o;p={},o=i.hotspots;for(n in o)e=o[n],r=!1,t.pages.forEach(function(t){null!=e.locations[t.pageNumber]&&(r=!0)}),r&&(p[n]={type:e.type,id:e.id,locations:e.locations});return l.trigger("hotspotsReceived",{id:t.id,pages:t.pages,ratio:i.details.dimensions.height,hotspots:p}),!1}))},jt.util.async.parallel([n,o],function(t){var n,r;n=t[0][1],r=t[1][1],null!=n&&null!=r?(i.details=n,i.pages=r,h()):e(new Error)}),!1!==t.showHotspots&&r(function(t,e){null==t&&(i.hotspots={},e.forEach(function(t){i.hotspots[t.id]=t}),u())})}};if(Bt=v,Bt.storage={local:m,cookie:b},Bt.request=function(t,e,i){var n,r,o,s,a,p,u,h,c,l,d,g,f;null==t&&(t={}),s=new XMLHttpRequest,p=null!=(h=t.method)?h:"get",g=t.url,o=null!=(c=t.headers)?c:{},null!=t.qs&&(u=y.util.formatQueryParams(t.qs),-1===g.indexOf("?")?g+="?"+u:g+="&"+u),s.open(p.toUpperCase(),g),null!=t.timeout&&(s.timeout=t.timeout),!0===t.useCookies&&(s.withCredentials=!0),!0===t.json&&(o["Content-Type"]="application/json",o.Accept="application/json"),l=t.headers;for(r in l)f=l[r],s.setRequestHeader(r,f);if(s.addEventListener("load",function(){var i;o=s.getAllResponseHeaders().split("\r\n"),o=o.reduce(function(t,e,i){var n;return n=e.split(": "),t[n[0].toLowerCase()]=n[1],t},{}),i=s.responseText,!0===t.json&&(i=JSON.parse(i)),e(null,{statusCode:s.status,headers:o,body:i})}),s.addEventListener("error",function(){e(new Error)}),s.addEventListener("timeout",function(){e(new Error)}),s.addEventListener("progress",function(t){t.lengthComputable&&"function"==typeof i&&i(t.loaded,t.total)}),null!=t.formData){n=new FormData,d=t.formData;for(a in d)f=d[a],n.append(a,f);s.send(n)}else null!=t.body?!0===t.json?s.send(JSON.stringify(t.body)):s.send(t.body):s.send()},Bt.AuthKit=w,Bt.AssetsKit=x,Bt.EventsKit=N,Bt.GraphKit=M,Bt.CoreKit=K,Bt.PagedPublicationKit=ie,"object"==typeof(te=Bt.storage.cookie.get("session"))&&Bt.config.set({coreSessionToken:te.token,coreSessionClientId:te.client_id}),Bt.client=function(){var t,e;return e=Bt.storage.local.get("client-id"),(t=null==e)&&(e=Bt.util.uuid(),Bt.storage.local.set("client-id",e)),{firstOpen:t,id:e}}(),Bt.config.bind("change",function(t){var e;null!=(e=t.eventTracker)&&(!0===Bt.client.firstOpen&&e.trackEvent("first-client-session-opened",{},"1.0.0"),e.trackEvent("client-session-opened",{},"1.0.0"))}),null!=($t=document.getElementById("sgn-sdk")))for(Yt=$t.getAttribute("data-app-key"),ee=$t.getAttribute("data-track-id"),Zt={},null!=Yt&&(Zt.appKey=Yt),null!=ee&&(Zt.eventTracker=new Bt.EventsKit.Tracker({trackId:ee})),Bt.config.set(Zt),Gt=0,Jt=(Qt=document.querySelectorAll(".shopgun-paged-publication")).length;Gt<Jt;Gt++)Kt=Qt[Gt],new Bt.PagedPublicationKit.Widget(Kt);return Bt});
